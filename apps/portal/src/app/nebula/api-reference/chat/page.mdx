import { EndpointMetadata } from './EndpointMetadata';

<EndpointMetadata />

#### Acciones de Chat

Las acciones de chat representan transacciones o operaciones en blockchain que Nebula ha preparado en respuesta a tu solicitud. La respuesta incluye tanto una explicación detallada en el campo `message` como los datos de la transacción en el array `actions`.

**Respuesta de Ejemplo con Acción de Chat:**
```json
{
  "message": "The transaction to transfer 0.0001 ETH to the address resolved from the ENS name `vitalik.eth` (which is `0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045`) is set up successfully. The simulation indicates that the transaction is likely to succeed.\n\nPlease proceed by signing and confirming the transaction.",
  "actions": [
    {
      "session_id": "437a0df7-d512-4ef4-95b5-6168ccbbe097",
      "request_id": "c2b51ed6-da79-49ac-b411-206a42059509",
      "type": "sign_transaction",
      "source": "executor",
      "data": "{\"chainId\": 11155111, \"to\": \"0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045\", \"data\": \"0x\", \"value\": \"0x5af3107a4000\"}"
    }
  ],
  "session_id": "437a0df7-d512-4ef4-95b5-6168ccbbe097",
  "request_id": "c2b51ed6-da79-49ac-b411-206a42059509"
}
```

**Propiedades de la Acción:**
- `session_id`: Identificador único de la sesión actual
- `request_id`: Identificador único para la solicitud específica
- `type`: Tipo de acción (por ejemplo, "sign_transaction")
- `source`: Origen de la acción (por ejemplo, "executor")
- `data`: Parámetros de la transacción, incluyendo:
  - `chainId`: Identificador de la red (por ejemplo, 11155111 para Sepolia)
  - `to`: Dirección del destinatario
  - `data`: Datos de la transacción (si los hay)
  - `value`: Monto a enviar en wei

Al manejar acciones:
1. Analiza el campo `message` para obtener detalles legibles de la transacción.
2. Extrae los datos de la transacción del array `actions`.
3. Presenta los detalles de la transacción al usuario para su revisión.
4. Utiliza una cartera local para firmar la transacción.
5. Transmite la transacción firmada a la red.

**Implementación de Ejemplo con el SDK de thirdweb:**

```javascript
import {
  createThirdwebClient,
  prepareTransaction,
  sendTransaction,
  privateKeyToAccount
} from "thirdweb";

// Example function to handle the API response
async function handleNebulaResponse(response) {
  // Initialize thirdweb client
  const client = createThirdwebClient({
    secretKey: process.env.THIRDWEB_SECRET_KEY
  });

  // Initialize account
  const account = privateKeyToAccount({
    client,
    privateKey: process.env.EOA_PRIVATE_KEY
  });

  // Check if we have any actions
  if (response.actions && response.actions.length > 0) {
    const action = response.actions[0];

    // Parse the transaction data from the action
    const txData = JSON.parse(action.data);

    try {
      // Prepare transaction with client
      const transaction = prepareTransaction({
        to: txData.to,
        data: txData.data,
        value: BigInt(txData.value),
        chain: txData.chainId,
        client
      });

      // Send transaction with account
      const result = await sendTransaction({
        transaction,
        account
      });

      return result;
    } catch (error) {
      console.error("Error processing transaction:", error);
      throw error;
    }
  }
}

// Example usage
const response = await fetch('https://nebula-api.thirdweb.com/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-secret-key': 'YOUR_THIRDWEB_SECRET_KEY'
  },
  body: JSON.stringify({
    message: "send 0.0001 ETH on sepolia to vitalik.eth",
    execute_config: {
      mode: "client",
      signer_wallet_address: "0xc3F2b2a12Eba0f5989cD75B2964E31D56603a2cE"
    }
  })
});

const data = await response.json();
const result = await handleNebulaResponse(data);
```
