import { Step, Steps, DocImage, Callout } from "@doc";
import NewProject from "../assets/new-project.png";
import KeysSetup from "../assets/keys.png";

# Comienza

Aprende cómo configurar y empezar con la API de Nebula para preparar y habilitar con éxito a un usuario conectado para firmar una transferencia.

## Requisitos Previos

Antes de comenzar, asegúrate de tener lo siguiente:

- Una cuenta en thirdweb  
- Una cartera blockchain para ejecutar transacciones  
- Node.js y npm o yarn instalados en tu sistema  

## Obtén el ID de Cliente y la Clave Secreta

<Steps>

<Step title="Crear proyecto">

Dirígete al [panel de proyectos](https://thirdweb.com/) y crea un nuevo proyecto.

<DocImage src={NewProject} alt="Crear un nuevo proyecto"/>
  
</Step>

<Step title="Obtener claves">

Configura tu proyecto y obtén tu ID de cliente y clave secreta. Guarda tu clave secreta en un lugar seguro, ya que no es recuperable.

<Callout variant="warning" title="ID de Cliente vs Clave Secreta">
El ID de Cliente se utiliza en el lado del cliente y está restringido por las restricciones de dominio que configures en tu clave API. Es un identificador público que puede ser usado de forma segura en el frontend.

La clave secreta se utiliza en el lado del servidor o en scripts y no está restringida por las restricciones de dominio. Nunca expongas tu clave secreta en código del lado del cliente.
</Callout>

<DocImage src={KeysSetup} alt="Obtener claves"/>

</Step>

</Steps>

## Configurar la API (TypeScript SDK)

<Steps>

<Step title="Instalar SDK">

Instala el SDK de TypeScript.


```bash
npm install thirdweb
```
</Step>

<Step title="Variables de Entorno">

Configura las variables de entorno.

<Callout variant="warning" title="Almacenamiento de Claves Secretas">
  Asegúrate de mantener tu clave secreta y clave privada seguras, y no las expongas en tu base de código. Recomendamos usar un gestor de claves secretas como [AWS Secret Manager](https://aws.amazon.com/secrets-manager/) o [Google Secret Manager](https://cloud.google.com/secret-manager).
</Callout>


```jsx
THIRDWEB_SECRET_KEY=your_thirdweb_secret_key
EOA_PRIVATE_KEY=your_wallet_private_key
```
</Step>

<Step title="Importar Bibliotecas">

Importa las bibliotecas necesarias desde thirdweb.

```jsx
import {
    createThirdwebClient,
  prepareTransaction,
  sendTransaction,
  privateKeyToAccount,
} from "thirdweb";
```
</Step>

<Step title="Crear Función para Manejar la Respuesta">
Esta función procesa la respuesta de la API y ejecuta transacciones en la blockchain.

```jsx
async function handleNebulaResponse(response) {
  const client = createThirdwebClient({
    secretKey: process.env.THIRDWEB_SECRET_KEY,
  });

  const account = privateKeyToAccount({
    client,
    privateKey: process.env.EOA_PRIVATE_KEY,
  });

  if (response.actions && response.actions.length > 0) {
    const action = response.actions[0];
    const txData = JSON.parse(action.data);

    try {
      const transaction = prepareTransaction({
        to: txData.to,
        data: txData.data,
        value: BigInt(txData.value),
        chain: txData.chainId,
        client,
      });

      const result = await sendTransaction({
        transaction,
        account,
      });

      console.log("Transaction Successful:", result);
      return result;
    } catch (error) {
      console.error("Error executing transaction:", error);
      throw error;
    }
  }
}
```
</Step>

<Step title="Llamar a la API de Nebula">

Envía una solicitud a la API de Nebula para interpretar tu comando en lenguaje natural y obtener los detalles de la transacción.

```jsx
const response = await fetch("https://nebula-api.thirdweb.com/chat", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "x-secret-key": process.env.THIRDWEB_SECRET_KEY,
  },
  body: JSON.stringify({
    message: "send 0.001 ETH on Sepolia to vitalik.eth",
    execute_config: {
      mode: "client",
      signer_wallet_address: "0xYourWalletAddress",
    },
  }),
});

const data = await response.json();
await handleNebulaResponse(data);
```
</Step>

<Step title="Respuesta de Ejemplo">

La respuesta de la API contendrá los detalles de la transacción.

```jsx
Transaction Successful: {
  transactionHash: "0x123abc...",
  blockNumber: 1234567,
  ...
}
```
</Step>

¡Felicidades! Has configurado con éxito la API de Nebula y ejecutado una transacción utilizando el SDK de thirdweb.
</Steps>

### Recursos Adicionales

- [Documentación de la API de Nebula](https://portal.thirdweb.com/nebula/api-reference)  
- [Documentación del SDK de thirdweb](https://portal.thirdweb.com/typescript/v5)  