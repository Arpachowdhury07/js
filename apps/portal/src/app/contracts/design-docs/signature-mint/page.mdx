import { DocImage } from "@doc";
import diagram1 from "./assets/signature-drop-diagram.png";
import { createMetadata } from "@doc";

export const metadata = createMetadata({
	image: {
		title: "Documento de diseño de minting por firma",
		icon: "contract",
	},
	title: "Documento de diseño de minting por firma | thirdweb",
	description:
		"Este es un documento en vivo que explica qué es el contrato inteligente de minting por firma de thirdweb, cómo funciona, cómo puede ser utilizado y por qué está diseñado de la manera en que está.",
});

# Documento de diseño de minting por firma.

Este es un documento en vivo que explica el mecanismo de 'minting por firma' utilizado en los contratos inteligentes de [thirdweb](https://thirdweb.com/) `Token`.

El documento está escrito para lectores tanto técnicos como no técnicos. Si tienes más preguntas sobre los `Drop` de thirdweb, por favor [visita nuestro sitio de soporte](https://thirdweb.com/support) o crea un issue en GitHub.

## Contexto

El mecanismo de 'minting por firma' utilizado en los contratos inteligentes de [thirdweb](https://thirdweb.com/) `Token` es una forma en que un administrador de contrato autoriza la solicitud de una parte externa para acuñar tokens en el contrato del administrador. A un nivel alto, esto significa que puedes autorizar a una parte externa para acuñar tokens en tu contrato y especificar qué exactamente será acuñado por esa parte externa.

Un administrador de contrato firma un 'payload' o 'solicitud de minting' que especifica parámetros alrededor de un mint, por ejemplo, a qué dirección deben ser acuñados los tokens, qué precio debe cobrarse a cambio de los tokens acuñados, etc.

Cualquier parte externa puede entonces presentar un contrato inteligente que implemente el mecanismo de 'minting por firma' con un payload, junto con la firma generada del administrador del contrato firmando el payload. Los tokens serán acuñados según la información especificada en el payload.

El siguiente diagrama ilustra cómo es el flujo de 'minting por firma'. Por ejemplo, considera una aplicación web como [wombo.art](https://www.wombo.art/) que permite a un usuario generar arte en su sitio web. Una vez que un usuario haya generado arte en el sitio de wombo, wombo puede permitir al usuario acuñar su obra de arte generada como un NFT en el contrato de wombo, donde wombo puede garantizar que lo que el usuario acuñará en el contrato de wombo es la obra de arte generada prevista.

<DocImage src={diagram1} />

### Por qué estamos desarrollando `Signature Minting`

Hemos observado que existen principalmente tres contextos distintos bajo los cuales se acuñan tokens:

1. Acuñar tokens para ti mismo en un contrato que posees. Ej. una persona quiere acuñar su foto de perfil de Twitter como un NFT.
2. Hacer que una audiencia acuñe tokens en un contrato que posees.
   1. La naturaleza de los tokens a acuñar por la audiencia está pre-determinada por el administrador del contrato. Ej. una colección de NFT de 10k donde el contenido de los NFTs a acuñar por la audiencia ya es conocido y determinado por el administrador del contrato antes de que la audiencia comience a acuñar los NFTs.
   2. La naturaleza de los tokens a acuñar por la audiencia _no_ está pre-determinada por el administrador del contrato. Ej. un 'certificado' de curso generado dinámicamente con el nombre del participante del curso, que debe ser acuñado por el participante al completar el curso.

Los contratos `Drop` de thirdweb sirven para los casos descritos en 2(i).

Los contratos `Token` de thirdweb sirven para los casos descritos en (1) y 2(ii). Y el mecanismo de 'minting por firma' está diseñado especialmente para servir al caso descrito en 2(ii).

## Detalles técnicos

Ahora repasaremos los detalles técnicos involucrados en el mecanismo de 'minting por firma' ilustrado en el diagrama de la sección anterior.

### Payload / Solicitud de minting

Ahora cubriremos qué compone un payload, o 'solicitud de minting':

```solidity
struct MintRequest {
    address to;
    address royaltyRecipient;
    uint256 royaltyBps;
    address primarySaleRecipient;
    uint256 tokenId;
    string uri;
    uint256 quantity;
    uint256 pricePerToken;
    address currency;
    uint128 validityStartTimestamp;
    uint128 validityEndTimestamp;
    bytes32 uid;
}
```

| Parámetro             | Descripción                                                                                                                           |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| to                    | El receptor de los tokens a acuñar.                                                                                                  |
| royaltyRecipient      | El receptor de las regalías por ventas secundarias del token acuñado. (No aplicable para tokens ERC20)                               |
| royaltyBps            | El porcentaje de las ventas secundarias del token acuñado que se tomará como regalías. (No aplicable para tokens ERC20)              |
| primarySaleRecipient  | El receptor de los ingresos de las ventas primarias del token acuñado.                                                               |
| tokenId               | El tokenId del token a acuñar. (Solo aplicable para tokens ERC1155)                                                                  |
| uri                   | La URI de metadatos del token a acuñar. (No aplicable para tokens ERC20)                                                            |
| quantity              | La cantidad de tokens a acuñar.                                                                                                      |
| pricePerToken         | El precio a pagar por cada cantidad de tokens acuñados. (Para TokenERC20, este parámetro es `price`, lo que indica el precio total de todos los tokens) |
| currency              | La moneda con la que se pagará el precio por cada token acuñado.                                                                     |
| validityStartTimestamp| La marca de tiempo unix después de la cual el payload es válido.                                                                      |
| validityEndTimestamp  | La marca de tiempo unix en la que el payload expira.                                                                                  |
| uid                   | Un identificador único para el payload.                                                                                              |

Los campos descritos en `MintRequest` son lo que conforman un payload o 'solicitud de minting'. Este es el payload que un administrador de contrato firma, para ser usado por una parte externa para acuñar tokens en el contrato del administrador.

Cuando cualquier parte externa presenta un payload al contrato que implementa el mecanismo de 'minting por firma', los tokens son acuñados exactamente de acuerdo con la información especificada en el `MintRequest` presentado.

### Acuñación de tokens con un payload / 'solicitud de minting'

Cualquier parte externa puede presentar un contrato inteligente que implemente el mecanismo de 'minting por firma' con un payload, junto con la firma generada por un administrador de contrato al firmar el payload. Los tokens serán acuñados de acuerdo con la información especificada en el payload.

Para acuñar tokens con un payload, se llama a la siguiente función:

```solidity
function mintWithSignature(MintRequest calldata req, bytes calldata signature) external payable;
```

| Parámetro | Descripción                                                    |
| --------- | -------------------------------------------------------------- |
| req       | El payload / solicitud de minting.                              |
| signature| La firma producida por una cuenta al firmar la solicitud de minting. |

El contrato que implementa el mecanismo de 'minting por firma' primero recupera la dirección del firmante a partir del payload dado, es decir, `req` y la `firma`, y verifica que una dirección autorizada haya firmado esta solicitud de minting entrante.

Una vez verificado, los tokens son acuñados de acuerdo con la información especificada en el payload.
