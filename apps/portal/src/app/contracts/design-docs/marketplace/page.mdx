import { createMetadata } from "@doc";

export const metadata = createMetadata({
	image: {
		title: "Documento de dise√±o del Marketplace V3",
		icon: "contract",
	},
	title: "Documento de dise√±o del Marketplace V3 | thirdweb",
	description:
		"Este es un documento en vivo que explica qu√© es el contrato inteligente Marketplace V3 de thirdweb, c√≥mo funciona, c√≥mo se puede usar y por qu√© est√° escrito de la forma en que est√°",
});

# Documento de dise√±o de Marketplace V3.

Este es un documento en vivo que explica qu√© es el contrato inteligente `Marketplace V3` de [thirdweb](https://thirdweb.com/), c√≥mo funciona, c√≥mo se puede usar y por qu√© est√° escrito de la forma en que est√°.

El documento est√° escrito para lectores t√©cnicos y no t√©cnicos. Para hacer m√°s preguntas sobre `Marketplace V3`, por favor [visita nuestro sitio de soporte](https://thirdweb.com/contact-us) o crea un [problema en GitHub](https://github.com/thirdweb-dev/contracts/issues).

## Contexto

El contrato `Marketplace V3` de [thirdweb](https://thirdweb.com/) es un mercado donde las personas pueden vender NFTs ‚Äî [ERC 721](https://eips.ethereum.org/EIPS/eip-721) o [ERC 1155](https://eips.ethereum.org/EIPS/eip-1155) ‚Äî a un precio fijo (lo que llamaremos "Listado directo") o subastarlos (lo que llamaremos "Listado de subasta"). Tambi√©n permite a los usuarios hacer "Ofertas" en NFTs no listados.

`Marketplace V3` ofrece mejoras sobre la versi√≥n anterior en t√©rminos de dise√±o y caracter√≠sticas, las cuales se discuten en este documento. Puedes consultar el documento de dise√±o de la versi√≥n anterior (v2) de `Marketplace` [aqu√≠](https://github.com/thirdweb-dev/contracts/blob/main/contracts/old-marketplace/marketplace.md).

## Contexto detr√°s de esta actualizaci√≥n

Le hemos dado a `Marketplace` una actualizaci√≥n que hac√≠a falta. El producto del mercado sigue estando compuesto por tres formas principales de intercambiar NFTs por dinero:

1. Vender NFTs a trav√©s de un ‚Äòlistado directo‚Äô.
2. Subastar NFTs.
3. Hacer ofertas por NFTs que no est√°n a la venta en absoluto o a precios favorables.

La mejora principal del contrato inteligente `Marketplace V3` es una mejor experiencia de desarrollo al trabajar con el contrato.

La versi√≥n anterior ten√≠a algunas limitaciones, derivadas de (1) el l√≠mite de tama√±o del contrato inteligente de `~24.576 kb` en Ethereum mainnet (y otras cadenas compatibles con thirdweb), y (2) la forma en que se organiza el c√≥digo del contrato inteligente (un solo contrato grande que hereda otros contratos). El contrato inteligente de `Marketplace` anterior ten√≠a funciones que realizaban m√∫ltiples tareas, se comportaban de diferentes maneras seg√∫n las circunstancias y carec√≠an de funciones de visualizaci√≥n convenientes para leer datos f√°cilmente.

Adem√°s, con el tiempo, recibimos solicitudes de caracter√≠sticas para `Marketplace`, algunas de las cuales se han incorporado en `Marketplace V3`, por ejemplo:

- Capacidad de aceptar m√∫ltiples monedas para listados directos
- Capacidad de cancelar listados expl√≠citamente
- Funciones getter expl√≠citas para obtener estados de alto nivel, como "¬øha terminado la subasta?", "¬øqui√©n es el postor ganador?", etc.
- Simplificar el tiempo de inicio y el tiempo de expiraci√≥n de los listados

Por todas estas razones y adiciones de caracter√≠sticas, el contrato `Marketplace` est√° recibiendo una actualizaci√≥n y se est√° lanzando como `Marketplace V3`. En esta actualizaci√≥n:

- El contrato se ha desglosado en extensiones independientes (que luego se ofrecen en el SDK de Solidity).
- El contrato proporciona funciones expl√≠citas para cada acci√≥n importante (algo que faltaba en el contrato actual).
- El contrato proporciona funciones de visualizaci√≥n convenientes para todo el estado relevante del contrato, sin esperar que los usuarios dependan de eventos para leer informaci√≥n cr√≠tica.

Finalmente, para lograr todo esto sin la restricci√≥n del l√≠mite de tama√±o del contrato inteligente, el contrato `Marketplace V3` est√° escrito en el siguiente nuevo patr√≥n de c√≥digo, al que llamamos `Plugin Pattern`. Fue influenciado por [EIP-2535](https://eips.ethereum.org/EIPS/eip-2535). Puedes leer m√°s sobre Plugin Pattern [aqu√≠](https://blog.thirdweb.com/).

## Extensiones que componen `Marketplace V3`

El contrato inteligente `Marketplace V3` ahora est√° escrito como la suma de tres contratos inteligentes de extensi√≥n principales:

1. `DirectListings`: Lista NFTs para la venta a un precio fijo. Compra NFTs de los listados.
2. `EnglishAuctions`: Coloca NFTs en subasta. Realiza ofertas por NFTs en subasta. La oferta m√°s alta dentro de la duraci√≥n de la subasta gana.
3. `Offers`: Realiza ofertas de ERC20 o moneda nativa para NFTs. Acepta una oferta favorable si posees los NFTs deseados.

Cada uno de estos contratos inteligentes de extensi√≥n es independiente y no se preocupa por el estado de los otros contratos de extensi√≥n.

### C√≥mo ser√° el Marketplace para los usuarios

Existen dos grupos de usuarios: (1) los clientes de thirdweb que configuran el mercado y (2) los usuarios finales de los mercados de los clientes de thirdweb.

Para los clientes de thirdweb, el mercado puede configurarse como cualquiera de los otros contratos de thirdweb (por ejemplo, 'Colecci√≥n NFT') a trav√©s del panel de control de thirdweb, el SDK de thirdweb o consumiendo directamente el contrato inteligente del mercado de c√≥digo abierto.

Para los usuarios finales de los clientes de thirdweb, la experiencia de usar el mercado ser√° similar a la de plataformas de mercado populares como OpenSea, Zora, etc. La principal diferencia en la experiencia del usuario ser√° que realizar cualquier acci√≥n en el mercado requiere tarifas de gas.

- Clientes de thirdweb
  - Despliegan el contrato del mercado como cualquier otro contrato de thirdweb.
  - Pueden establecer un porcentaje de 'tarifa de plataforma'. Este porcentaje se cobra en cada venta: cuando un comprador compra tokens de un listado directo y cuando un vendedor recoge la oferta m√°s alta en el cierre de la subasta. Esta tarifa de plataforma se distribuye al destinatario de la tarifa de la plataforma (establecido por un administrador del contrato).
  - Pueden listar NFTs para la venta a un precio fijo.
  - Pueden editar los par√°metros de un listado existente, por ejemplo, la moneda aceptada. Los par√°metros de una subasta no se pueden editar una vez que ha comenzado.
  - Pueden hacer ofertas por NFTs listados/no listados para un precio fijo.
  - Pueden subastar NFTs.
  - Pueden hacer ofertas en subastas.
  - Deben pagar tarifas de gas para realizar cualquier acci√≥n, incluidas las acciones mencionadas.

### EIPs implementados / soportados

Para poder escrolear NFTs en el caso de las subastas, Marketplace implementa las interfaces receptoras para [ERC1155](https://eips.ethereum.org/EIPS/eip-1155) y [ERC721](https://eips.ethereum.org/EIPS/eip-721).

Para habilitar las metatransacciones (sin gas), Marketplace implementa [ERC2771](https://eips.ethereum.org/EIPS/eip-2771).

Marketplace tambi√©n honra [ERC2981](https://eips.ethereum.org/EIPS/eip-2981) para la distribuci√≥n de regal√≠as en los listados directos y en las subastas.

### Eventos emitidos

Todos los eventos emitidos por el contrato, as√≠ como cu√°ndo se emiten, se pueden encontrar en la interfaz del contrato, [aqu√≠](https://github.com/thirdweb-dev/contracts/blob/main/contracts/marketplace/IMarketplace.sol). En general, los eventos se emiten siempre que hay un cambio de estado en el contrato.

### Transferencias de moneda

El contrato admite tanto monedas ERC20 como la moneda nativa de la cadena (por ejemplo, ether para Ethereum mainnet). Esto significa que cualquier acci√≥n que implique transferir moneda (por ejemplo, comprar un token de un listado directo) se puede realizar con un token ERC20 o con la moneda nativa de la cadena.

üí° **Nota**: La excepci√≥n son las ofertas: estas solo se pueden hacer con tokens ERC20, ya que Marketplace necesita transferir el monto de la oferta del comprador al vendedor, en caso de que el √∫ltimo acepte la oferta. Esto no se puede hacer con monedas nativas sin escrolear la cantidad de moneda requerida.

El contrato envuelve todos los tokens nativos depositados en √©l como la versi√≥n ERC20 can√≥nica del token nativo (por ejemplo, WETH para ether). El contrato desenrolla el token nativo envuelto al transferir tokens nativos a una direcci√≥n determinada.

Si el contrato no puede transferir tokens nativos, los envuelve de nuevo a tokens nativos envueltos y los transfiere a la direcci√≥n correspondiente. El contrato puede fallar al transferir tokens nativos a una direcci√≥n, si la direcci√≥n representa un contrato inteligente que no puede aceptar tokens nativos transferidos directamente.

## Referencia de la API para Extensiones

### Listados directos

El contrato inteligente de extensi√≥n `DirectListings` te permite comprar y vender NFTs (ERC-721 o ERC-1155) a un precio fijo.

### `createListing`

**Qu√© hace:** Lista NFTs (ERC721 o ERC1155) para la venta a un precio fijo.

- Interfaz

  ```solidity
  struct ListingParameters {
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 pricePerToken;
    uint128 startTimestamp;
    uint128 endTimestamp;
    bool reserved;
  }

  function createListing(ListingParameters memory params) external returns (uint256 listingId);

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | ------------- | --------------------------------------------------------------------------------------------------- |
  | assetContract | La direcci√≥n del contrato inteligente de los NFTs que se est√°n listando. |
  | tokenId | El tokenId de los NFTs que se est√°n listando. |
  | cantidad | La cantidad de NFTs que se est√°n listando. Esto debe ser mayor que cero, y se espera que sea 1 para los NFTs ERC-721. |
  | currency | La moneda en la que se debe pagar al comprar los NFTs listados. La direcci√≥n considerada para los tokens nativos de la cadena es 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE |
  | pricePerToken | El precio que se debe pagar por unidad de NFT listado. |
  | startTimestamp | El timestamp UNIX en el que los NFTs pueden ser comprados desde el listado. |
  | expirationTimestamp | El timestamp UNIX despu√©s del cual los NFTs no pueden ser comprados desde el listado. |
  | reserved | Indica si el listado est√° reservado para ser comprado por un conjunto espec√≠fico de compradores. |
- Criterios que deben cumplirse
  - El creador del listado debe ser propietario de los NFTs que est√° listando.
  - El creador del listado debe haber aprobado previamente a Marketplace para transferir los NFTs que est√° listando (ya que no se requiere que el creador deposite los NFTs en Marketplace).
  - El creador del listado debe listar una cantidad no nula de tokens. Si se listan tokens ERC-721, el creador solo puede listar la cantidad `1`.
  - El tiempo de inicio del listado no debe ser menor a 1 hora despu√©s del timestamp del bloque de la transacci√≥n. El tiempo de finalizaci√≥n del listado debe ser posterior al tiempo de inicio.
  - Solo se deben listar tokens ERC-721 o ERC-1155.
  - El creador del listado debe tener el rol `LISTER_ROLE` si las restricciones de roles est√°n activas.
  - El activo que se lista debe tener el rol `ASSET_ROLE` si las restricciones de roles est√°n activas.

### `updateListing`

**Qu√© hace:** Actualiza la informaci√≥n (por ejemplo, el precio) de uno de tus listados en el marketplace.

- Interfaz

  ```solidity
  struct ListingParameters {
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 pricePerToken;
    uint128 startTimestamp;
    uint128 endTimestamp;
    bool reserved;
  }

  function updateListing(uint256 listingId, ListingParameters memory params) external
  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | ------------- | --------------------------------------------------------------------------------------------------- |
  | listingId | El ID √∫nico del listado que se est√° actualizando. |
  | assetContract | La direcci√≥n del contrato inteligente de los NFTs que se est√°n listando. |
  | tokenId | El tokenId de los NFTs que se est√°n listando. |
  | cantidad | La cantidad de NFTs que se est√°n listando. Esto debe ser mayor que cero, y se espera que sea 1 para los NFTs ERC-721. |
  | currency | La moneda en la que se debe pagar al comprar los NFTs listados. La direcci√≥n considerada para los tokens nativos de la cadena es 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE |
  | pricePerToken | El precio que se debe pagar por unidad de NFT listado. |
  | startTimestamp | El timestamp UNIX en el que los NFTs pueden ser comprados desde el listado. |
  | expirationTimestamp | El timestamp UNIX despu√©s del cual los NFTs no pueden ser comprados desde el listado. |
  | reserved | Indica si el listado est√° reservado para ser comprado por un conjunto espec√≠fico de compradores. |
- Criterios que deben cumplirse
  - El llamador de la funci√≥n _debe_ ser el creador del listado que se est√° actualizando.
  - El creador del listado debe ser propietario de los NFTs que est√° listando.
  - El creador del listado debe haber aprobado previamente a Marketplace para transferir los NFTs que est√° listando (ya que no se requiere que el creador deposite los NFTs en Marketplace).
  - El creador del listado debe listar una cantidad no nula de tokens. Si se listan tokens ERC-721, el creador solo puede listar la cantidad `1`.
  - Solo se deben listar tokens ERC-721 o ERC-1155.
  - El tiempo de inicio del listado debe ser mayor o igual al timestamp de inicio actual. El tiempo de finalizaci√≥n del listado debe ser posterior al tiempo de inicio.
  - El activo que se lista debe tener el rol `ASSET_ROLE` si las restricciones de roles est√°n activas.

### `cancelListing`

**Qu√© hace:** Cancela (es decir, elimina) uno de tus listados en el marketplace.

- Interfaz

  ```solidity
  function cancelListing(uint256 listingId) external;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | --------- | --------------------------------------------------- |
  | listingId | El ID √∫nico del listado a cancelar, es decir, eliminar. |
- Criterios que deben cumplirse
  - El llamador de la funci√≥n _debe_ ser el creador del listado que se est√° cancelando.
  - El listado debe existir.

### `approveBuyerForListing`

**Qu√© hace:** Aprueba a un comprador para que pueda comprar de un listado reservado.

- Interfaz

  ```solidity
  function approveBuyerForListing(
    uint256 listingId,
    address buyer,
    bool toApprove
  ) external;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | --------- | ------------------------------------------------------------ |
  | listingId | El ID √∫nico del listado. |
  | buyer | La direcci√≥n del comprador a aprobar para comprar del listado. |
  | toApprove | Si se aprueba o no al comprador para comprar del listado. |
- Criterios que deben cumplirse
  - El llamador de la funci√≥n _debe_ ser el creador del listado en cuesti√≥n.
  - El listado debe estar reservado.

### `approveCurrencyForListing`

**Qu√© hace:** Aprueba una moneda como forma de pago para el listado.

- Interfaz

  ```solidity
  function approveCurrencyForListing(
    uint256 listingId,
    address currency,
    uint256 pricePerTokenInCurrency,
  ) external;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | ----------------------- | ---------------------------------------------------------------------------- |
  | listingId | El ID √∫nico del listado. |
  | currency | La direcci√≥n de la moneda para aprobar como forma de pago para el listado. |
  | pricePerTokenInCurrency | El precio por token para la moneda aprobada. Un valor de 0 desaprueba una moneda. |
- Criterios que deben cumplirse
  - El llamador de la funci√≥n _debe_ ser el creador del listado en cuesti√≥n.
  - La moneda aprobada no debe ser la moneda principal aceptada por el listado.

### `buyFromListing`

**Qu√© hace:** Comprar NFTs de un listado.

- Interfaz

  ```solidity
  function buyFromListing(
    uint256 listingId,
    address buyFor,
    uint256 quantity,
    address currency,
    uint256 expectedTotalPrice
  ) external payable;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | ------------------ | ---------------------------------------------------------- |
  | listingId | El ID √∫nico del listado desde el que comprar los NFTs. |
  | buyFor | El destinatario de los NFTs comprados. |
  | quantity | La cantidad de NFTs a comprar del listado. |
  | currency | La moneda a utilizar para pagar los NFTs. |
  | expectedTotalPrice | El precio total esperado a pagar por los NFTs comprados. |
- Criterios que deben cumplirse
  - El comprador debe poseer la cantidad total necesaria para pagar los NFTs que est√° comprando.
  - El comprador debe aprobar el Marketplace para transferir la cantidad total necesaria para pagar los NFTs.
  - Si se paga en tokens nativos, el comprador debe enviar exactamente la cantidad total esperada de tokens nativos junto con la transacci√≥n.
  - El precio total esperado del comprador debe coincidir con el precio total real de los NFTs comprados.
  - El comprador debe comprar una cantidad no nula de NFTs.
  - El comprador no debe intentar comprar m√°s NFTs de los que est√°n listados en ese momento.
  - El comprador debe pagar en una moneda aprobada por el creador del listado.

### `totalListings`

**Qu√© hace:** Devuelve el n√∫mero total de listados creados hasta el momento.

- Interfaz

  ```solidity
  function totalListings() external view returns (uint256);

  ```

### `getAllListings`

**Qu√© hace:** Devuelve todos los listados entre el ID de inicio y el ID final (ambos inclusive) proporcionados.

- Interfaz

  ```solidity
  enum TokenType {
    ERC721,
    ERC1155
  }

  enum Status {
    UNSET,
    CREATED,
    COMPLETED,
    CANCELLED
  }

  struct Listing {
    uint256 listingId;
    address listingCreator;
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 pricePerToken;
    uint128 startTimestamp;
    uint128 endTimestamp;
    bool reserved;
    TokenType tokenType;
    Status status;
  }

  function getAllListings(uint256 startId, uint256 endId) external view returns (Listing[] memory listings);

  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | startId | Inclusive start listing Id |
  | endId | Inclusive end listing Id |

### `getAllValidListings`

**Qu√© hace:** Devuelve todos los listados v√°lidos entre el ID de inicio y el ID final (ambos inclusive) proporcionados. Un listado v√°lido es aquel donde el listado est√° activo, as√≠ como el creador a√∫n posee y ha aprobado al Marketplace para transferir los NFTs listados.

- Interfaz


  ```solidity
  function getAllValidListings(uint256 startId, uint256 endId) external view returns (Listing[] memory listings);

  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | startId | Inclusive start listing Id |
  | endId | Inclusive end listing Id |

### `getListing`

**Qu√© hace:** Devuelve un listado en el ID de listado proporcionado.

- Interfaz

  ```solidity
  function getListing(uint256 listingId) external view returns (Listing memory listing);

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n |
  | --------- | ------------------------------- |
  | listingId | El ID del listado a obtener. |

## Subastas inglesas

El contrato inteligente de extensi√≥n `EnglishAuctions` te permite vender NFTs (ERC-721 o ERC-1155) en una subasta inglesa.

### `createAuction`

**Qu√© hace:** Pon NFTs (ERC721 o ERC1155) en una subasta inglesa.

- **¬øQu√© es una subasta inglesa?**
  - `Alice` deposita sus NFTs en el contrato de Marketplace y especifica: **[1]** una cantidad m√≠nima de oferta y **[2]** una duraci√≥n para la subasta.
  - `Bob` es la primera persona en hacer una oferta.
    - _Antes_ de que termine la duraci√≥n de la subasta, `Bob` hace una oferta en la subasta (‚â• oferta m√≠nima).
    - La oferta de `Bob` ahora se deposita y se bloquea en el Marketplace.
  - `Tom` tambi√©n quiere los NFTs subastados. La oferta de `Tom` _debe_ ser mayor que la oferta de `Bob`.
    - _Antes_ de que termine la duraci√≥n de la subasta, `Tom` hace una oferta en la subasta (‚â• oferta de `Bob`).
    - La oferta de `Tom` ahora se deposita y se bloquea en el Marketplace. La oferta de `Bob` se _reembolsa autom√°ticamente_.
  - _Despu√©s_ de que termine la duraci√≥n de la subasta:
    - `Alice` recoge la oferta m√°s alta que ha sido depositada en el Marketplace.
    - El ‚Äúofertante m√°s alto‚Äù (por ejemplo, `Tom`) recoge los NFTs subastados.
- Interfaz

  ```solidity
  struct AuctionParameters {
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 minimumBidAmount;
    uint256 buyoutBidAmount;
    uint64 timeBufferInSeconds;
    uint64 bidBufferBps;
    uint64 startTimestamp;
    uint64 endTimestamp;
  }

  function createAuction(AuctionParameters memory params) external returns (uint256 auctionId);

  ```

- Par√°metros
  | Par√°metro              | Descripci√≥n                                                                                                                   |
  | ---------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
  | assetContract          | La direcci√≥n del contrato inteligente de los NFTs que est√°n siendo subastados.                                                 |
  | tokenId                | El tokenId de los NFTs que est√°n siendo subastados.                                                                            |
  | quantity               | La cantidad de NFTs que est√°n siendo subastados. Esto debe ser mayor a cero, y se espera que sea 1 para NFTs ERC-721.         |
  | currency               | La moneda en la que se debe hacer la oferta para los NFTs subastados.                                                          |
  | minimumBidAmount       | La cantidad m√≠nima de oferta para la subasta.                                                                                  |
  | buyoutBidAmount        | La cantidad total de la oferta con la que el postor puede comprar directamente los art√≠culos subastados y cerrar la subasta.   |
  | timeBufferInSeconds    | Este es un buffer, por ejemplo, x segundos. Si se realiza una nueva oferta ganadora menos de x segundos antes del timestamp de expiraci√≥n, el timestamp de expiraci√≥n se incrementa por x segundos. |
  | bidBufferBps           | Este es un buffer en puntos base, por ejemplo, x%. Para que se considere una nueva oferta ganadora, la oferta debe ser al menos un x% mayor que la oferta ganadora actual. |
  | startTimestamp         | El timestamp en el cual se pueden hacer ofertas para la subasta.                                                               |
  | expirationTimestamp    | El timestamp despu√©s del cual no se pueden hacer m√°s ofertas para la subasta.                                                  |
- Criterios que deben cumplirse
  - El creador de la subasta debe ser propietario y haber aprobado al Marketplace para transferir los tokens subastados a s√≠ mismo.
  - El creador de la subasta debe subastar una cantidad no nula de tokens. Si el token subastado es ERC721, la cantidad debe ser `1`.
  - El creador de la subasta debe especificar un buffer de tiempo y de oferta no nulo.
  - La cantidad m√≠nima de oferta debe ser menor que la cantidad de compra inmediata.
  - El tiempo de inicio de la subasta no debe ser inferior a 1 hora m√°s del timestamp de bloque de la transacci√≥n. El tiempo de finalizaci√≥n de la subasta debe ser despu√©s del tiempo de inicio de la subasta.
  - El token subastado debe ser ERC-721 o ERC-1155.
  - El creador de la subasta debe tener el `LISTER_ROLE` si las restricciones de roles est√°n activas.
  - El activo que se subasta debe tener el `ASSET_ROLE` si las restricciones de roles est√°n activas.

### `cancelAuction`

**Qu√© hace:** Cancelar una subasta.

- Interfaz

  ```solidity
  function cancelAuction(uint256 auctionId) external;

  ```

- Par√°metros
  | Par√°metro  | Descripci√≥n                                                               |
  | ---------- | ------------------------------------------------------------------------- |
  | auctionId  | El ID √∫nico de la subasta a cancelar.                                      |
- Criterios que deben cumplirse
  - El que llama a la funci√≥n debe ser el creador de la subasta.
  - No debe haber ofertas realizadas en la subasta en curso. (Por defecto, esto es verdadero para todas las subastas que no han comenzado).

### `collectAuctionPayout`

**Qu√© hace:** Una vez que la subasta termina, recolecta la oferta m√°s alta realizada para los NFTs subastados.

- Interfaz

  ```solidity
  function collectAuctionPayout(uint256 auctionId) external;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n                                                         |
  | --------- | ------------------------------------------------------------------- |
  | auctionId | El ID √∫nico de la subasta para la cual recolectar el pago.         |
- Criterios que deben cumplirse
  - La subasta debe haber expirado.
  - La subasta debe haber recibido al menos una oferta v√°lida.

### `collectAuctionTokens`

**Qu√© hace:** Una vez que la subasta termina, recoge los NFTs subastados para los cuales fuiste el postor m√°s alto.

- Interfaz

  ```solidity
  function collectAuctionTokens(uint256 auctionId) external;

  ```

- Par√°metros
  | Par√°metro | Descripci√≥n                                                         |
  | --------- | ------------------------------------------------------------------- |
  | auctionId | El ID √∫nico de la subasta para la cual hacer una oferta.          |
- Criterios que deben cumplirse
  - La subasta debe estar activa.
  - El monto de la oferta debe ser mayor que la oferta actual.
  - El comprador debe tener suficiente saldo en la moneda seleccionada.
  - El comprador debe aprobar el Marketplace para transferir el monto de la oferta.

### `bidInAuction`

**Qu√© hace:** Realizar una oferta en una subasta.

- Interfaz

  ```solidity
  function bidInAuction(uint256 auctionId, uint256 bidAmount) external payable;
  ```

- Par√°metros
  | Par√°metro | Descripci√≥n                                                        |
  | --------- | ------------------------------------------------------------------ |
  | auctionId | El ID √∫nico de la subasta en la que se desea hacer la oferta.     |
  | bidAmount | El monto total de la oferta.                                      |
- Criterios que deben cumplirse
  - La subasta no debe haber expirado.
  - El llamante debe ser el propietario y debe aprobar el Marketplace para transferir el monto necesario de la oferta.
  - El monto de la oferta debe ser mayor que la oferta actual ganadora. (Para conveniencia, esto puede verificarse llamando a `isNewWinningBid`)

### `isNewWinningBid`

**Qu√© hace:** Verifica si el monto de la oferta proporcionada ser√≠a una nueva oferta ganadora.

- Interfaz

  ```solidity
  function isNewWinningBid(uint256 auctionId, uint256 bidAmount) external view returns (bool);
  ```

- Par√°metros
  | Par√°metro | Descripci√≥n                                                    |
  | --------- | -------------------------------------------------------------- |
  | auctionId | El ID √∫nico de la subasta en la que se desea hacer la oferta. |
  | bidAmount | El monto total de la oferta.                                  |
- Criterios que deben cumplirse
  - La subasta no debe haber sido cancelada ni haber expirado.

### `totalAuctions`

**Qu√© hace:** Devuelve el n√∫mero total de subastas creadas hasta el momento.

- Interfaz

  ```solidity
  function totalAuctions() external view returns (uint256);
  ```

### `getAuction`

**Qu√© hace:** Recupera la informaci√≥n de la subasta en un ID de subasta particular.

- Interfaz

  ```solidity
  struct Auction {
    uint256 auctionId;
    address auctionCreator;
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 minimumBidAmount;
    uint256 buyoutBidAmount;
    uint64 timeBufferInSeconds;
    uint64 bidBufferBps;
    uint64 startTimestamp;
    uint64 endTimestamp;
    TokenType tokenType;
    Status status;
  }

  function getAuction(uint256 auctionId) external view returns (Auction memory auction);

  ```

- Parameters
  | Parameter | Description |
  | --------- | ----------------------------- |
  | auctionId | The unique ID of the auction. |

### `getAllAuctions`

**Qu√© hace:** Devuelve todas las subastas entre el ID de inicio y el ID de finalizaci√≥n proporcionados (ambos inclusive).

- Interfaz

  ```solidity
  function getAllAuctions(uint256 startId, uint256 endId) external view returns (Auction[] memory auctions);
  ```

- Parameters
  | Parameter | Description |
  | --------- | ---------------------------- |
  | startId | ID de inicio de la subasta inclusivo |
  | endId | ID de finalizaci√≥n de la subasta inclusivo |

### `getAllValidAuctions`

**Qu√© hace:** Devuelve todas las subastas v√°lidas entre el ID de inicio y el ID de finalizaci√≥n proporcionados (ambos inclusive). Una subasta v√°lida es aquella en la que la subasta est√° activa, as√≠ como el creador a√∫n posee y ha aprobado al Marketplace para transferir los NFTs subastados.

- Interfaz

  ```solidity
  function getAllValidAuctions(uint256 startId, uint256 endId) external view returns (Auction[] memory auctions);
  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | startId | ID de inicio de la subasta inclusivo |
  | endId | ID de finalizaci√≥n de la subasta inclusivo |

### `getWinningBid`

**Qu√© hace:** Obtiene la oferta ganadora de una subasta.

- Interfaz

  ```solidity
  function getWinningBid(uint256 auctionId)
    external
    view
    returns (
      address bidder,
      address currency,
      uint256 bidAmount
    );

  ```

- Parameters
  | Parameter | Description |
  | --------- | ---------------------------- |
  | auctionId | El ID √∫nico de una subasta. |

### `isAuctionExpired`

**Qu√© hace:** Devuelve si una subasta ha expirado o no.

- Interfaz

  ```solidity
  function isAuctionExpired(uint256 auctionId) external view returns (bool);

  ```

- Parameters
  | Parameter | Description |
  | --------- | ---------------------------- |
  | auctionId | El ID √∫nico de una subasta. |

## Ofertas

### `makeOffer`

**Qu√© hace:** Hace una oferta por cualquier NFT ERC721 o ERC1155 (a menos que apliquen restricciones `ASSET_ROLE`).

- Interfaz

  ```solidity
  struct OfferParams {
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 totalPrice;
    uint256 expirationTimestamp;
  }

  function makeOffer(OfferParams memory params) external returns (uint256 offerId);

  ```

- Parameters
  | Parameter | Description |
  | ------------------- | ----------------------------------------- |
  | assetContract | La direcci√≥n del contrato de los NFTs deseados. |
  | tokenId | El tokenId de los NFTs deseados. |
  | quantity | La cantidad de NFTs deseados. |
  | currency | La moneda ofrecida por el NFT deseado. |
  | totalPrice | El precio ofrecido por los NFTs deseados. |
  | expirationTimestamp | La marca de tiempo en la que la oferta expira. |
- Criterios que deben cumplirse
  - El oferente debe poseer y aprobar Marketplace para transferir la cantidad requerida de la moneda ofrecida para los NFTs deseados.
  - El oferente debe hacer una oferta por una cantidad no nula de NFTs. Si se ofrece por tokens ERC721, la cantidad deseada debe ser `1`.
  - La marca de tiempo de expiraci√≥n debe ser mayor que la marca de tiempo del bloque, o dentro de 1 hora desde la marca de tiempo del bloque.

### `cancelOffer`

**Qu√© hace:** Cancela una oferta existente.

- Interfaz

  ```solidity
  function cancelOffer(uint256 offerId) external;

  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | offerId | El ID √∫nico de la oferta |
- Criterios que deben cumplirse
  - El que llama a la funci√≥n debe ser el oferente.

### `acceptOffer`

**Qu√© hace:** Aceptar una oferta realizada por tus NFTs.

- Interfaz

  ```solidity
  function acceptOffer(uint256 offerId) external;

  ```

- Parameters
  | Parameter | Description |
  | --------- | --------------------------- |
  | offerId | El ID √∫nico de la oferta. |
- Criterios que deben cumplirse
  - El que llama a la funci√≥n debe ser el propietario y haber aprobado el Marketplace para transferir los tokens para los cuales se ha hecho la oferta.
  - El oferente debe seguir siendo el propietario y haber aprobado el Marketplace para transferir la cantidad de moneda ofrecida para los NFTs deseados.

### `totalOffers`

**Qu√© hace:** Devuelve el n√∫mero total de ofertas creadas hasta el momento.

- Interfaz

  ```solidity
  function totalOffers() external view returns (uint256);

  ```

### `getOffer`

**Qu√© hace:** Devuelve la oferta en un ID de oferta espec√≠fico.

- Interfaz

  ```solidity
  struct Offer {
    uint256 offerId;
    address offeror;
    address assetContract;
    uint256 tokenId;
    uint256 quantity;
    address currency;
    uint256 totalPrice;
    uint256 expirationTimestamp;
    TokenType tokenType;
    Status status;
  }

  function getOffer(uint256 offerId) external view returns (Offer memory offer);

  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | offerId | The unique ID of an offer. |

### `getAllOffers`

**Qu√© hace:** Devuelve todas las ofertas entre el inicio y el final del ID (ambos inclusivos) proporcionados.

- Interfaz

  ```solidity
  function getAllOffers(uint256 startId, uint256 endId) external view returns (Offer[] memory offers);

  ```

- Parameters
  | Parameter | Description |
  | --------- | -------------------------- |
  | startId | Inclusive start offer Id |
  | endId | Inclusive end offer Id |

### `getAllValidOffers`

**Qu√© hace:** Devuelve todas las ofertas v√°lidas entre el inicio y el final del ID (ambos inclusivos) proporcionados. Una oferta v√°lida es aquella en la que la oferta est√° activa, as√≠ como el oferente a√∫n posee y ha aprobado a Marketplace para transferir los tokens de la moneda.

- Interfaz

  ```solidity
  function getAllValidOffer(uint256 startId, uint256 endId) external view returns (Offer[] memory offers);

  ```

- Par√°metros
  | Par√°metro  | Descripci√≥n                                       |
  | ---------- | ------------------------------------------------- |
  | startId    | ID de inicio de la oferta (inclusive)             |
  | endId      | ID final de la oferta (inclusive)                 |
