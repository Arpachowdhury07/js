import { Details, Callout, GithubButtonLink } from "@doc";
import { createMetadata } from "@doc";

export const metadata = createMetadata({
	image: {
		title: "Contrato BaseAccountFactory",
		icon: "solidity",
	},
	title: "BaseAccountFactory | contrato de thirdweb",
	description:
		"El contrato BaseAccountFactory es una extensión que se puede usar con los contratos inteligentes de Cuenta Administrada y No Actualizable",
});


# BaseAccountFactory

```solidity
import "@thirdweb-dev/contracts/smart-wallet/utils/BaseAccountFactory.sol";
```

El contrato inteligente `BaseAccountFactory` es una extensión que se puede usar con los contratos inteligentes de Cuenta [Administrada](/contracts/build/base-contracts/erc-4337/managed-account) y [No Actualizable](/contracts/build/base-contracts/erc-4337/account-factory).
Al crear tu contrato de fábrica de [Cuenta Inteligente](/glossary/smart-wallet), hereda de esta extensión para incluir toda la lógica base para crear tu fábrica.

<Callout title="info" variant="info">
	Esta extensión de contrato inteligente cumple con la interfaz `IAccountFactory`
	que es detectable en el dashboard como la extensión `SmartWalletFactory`.
</Callout>

<br />

<GithubButtonLink href="https://github.com/thirdweb-dev/contracts/blob/main/contracts/prebuilts/account/utils/BaseAccountFactory.sol" />

## Uso

La extensión `BaseAccountFactory` es un _contrato abstracto_, y espera que implementes las siguientes funciones por ti mismo:

| Nombre                | Tipo                | Descripción                                                                             |
| --------------------- | ------------------- | --------------------------------------------------------------------------------------- |
| `_initializeAccount`  | internal _virtual_  | Se llama en `createAccount`. Inicializa el contrato de cuenta creado en `createAccount`. |

Este es un contrato de ejemplo para la fábrica que demuestra cómo heredar de esta extensión y sobrescribir las funciones para añadir (opcionalmente) funcionalidad personalizada.

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@thirdweb-dev/contracts/smart-wallet/utils/BaseAccountFactory.sol";

contract MyAccountFactory is BaseAccountFactory { ... }
```

## Uso del SDK

Esta extensión desbloquea el uso de la [cartera inteligente](wallet/smart-wallet) en el SDK de la cartera.

## Contratos Base que Implementan Esta Extensión

- [ManagedAccountFactory](/contracts/build/base-contracts/erc-4337/managed-account-factory)
- [AccountFactory](/contracts/build/base-contracts/erc-4337/account-factory)

## Referencia Completa de la API

<Details summary="createAccount">

Despliega una nueva Cuenta para el administrador.

```solidity
function createAccount(address _admin, bytes calldata _data) external virtual override returns (address) {
    address impl = accountImplementation;
    bytes32 salt = _generateSalt(_admin, _data);
    address account = Clones.predictDeterministicAddress(impl, salt);
    if (account.code.length > 0) {
        return account;
    }
    account = Clones.cloneDeterministic(impl, salt);
    _initializeAccount(account, _admin, _data);
    emit AccountCreated(account, _admin);
    return account;
}
```

#### \_admin

La dirección que se establecerá como el rol de administrador predeterminado para el contrato. Debe ser de tipo `address`.

#### \_data

Si se requieren variables de almacenamiento adicionales en tu contrato de cuenta, sobrescribe esta función, codifica las variables en ABI,
pásalas a esta función como un tipo `bytes`.

</Details>

<Details summary="addSigner">

Función de retorno de llamada para que una Cuenta registre sus firmantes.

```solidity
function addSigner(address _signer) external {
    address account = msg.sender;
    bool isAlreadyAccount = accountsOfSigner[_signer].add(account);
    bool isAlreadySigner = signersOfAccount[account].add(_signer);
    if (!isAlreadyAccount || !isAlreadySigner) {
        revert("AccountFactory: signer already added");
    }
    emit SignerAdded(account, _signer);
}
```

#### signer

La dirección del firmante que se agregará a la cuenta.

</Details>

<Details summary="removeSigner">

Función de retorno de llamada para que una Cuenta elimine su registro de firmantes.

```solidity
function removeSigner(address _signer) external {
    address account = msg.sender;
    bool isAccount = accountsOfSigner[_signer].remove(account);
    bool isSigner = signersOfAccount[account].remove(_signer);
    if (!isAccount || !isSigner) {
        revert("AccountFactory: signer not found");
    }
    emit SignerRemoved(account, _signer);
}
```

#### _signer

La dirección del firmante que se eliminará de la cuenta.

</Details>

<Details summary="getAddress">

Devuelve la dirección de una Cuenta que se desplegaría con el firmante de administrador dado.

```solidity
function getAddress(address _adminSigner) public view returns (address) {
    bytes32 salt = _generateSalt(_admin, _data);
    return Clones.predictDeterministicAddress(accountImplementation, salt);
}
```

#### _adminSigner

El firmante administrador para la cuenta.

</Details>

<Details summary="getSignersOfAccount">

Devuelve todos los firmantes de una cuenta.

```solidity
function getSignersOfAccount(address account) external view returns (address[] memory signers) {
    return signersOfAccount[account].values();
}
```

#### account

La dirección de la cuenta para obtener los firmantes.

</Details>

<Details summary="getAccountsOfSigner">

Devuelve todas las cuentas de las que la dirección dada es firmante.

```solidity
function getAccountsOfSigner(address signer) external view returns (address[] memory accounts) {
    return accountsOfSigner[signer].values();
}
```

#### signer

La dirección del firmante para obtener las cuentas de las que es firmante.

</Details>

<Details summary="_initializeAccount">

Se llama en `createAccount`. Inicializa el contrato de la cuenta creado en `createAccount`.

```solidity
function _initializeAccount(
    address _account,
    address _admin,
    bytes calldata _data
) internal virtual;
```

#### _account

La dirección del contrato inteligente de la cuenta inteligente para inicializar.

#### _admin

La dirección que se establecerá como el rol de administrador predeterminado para el contrato. Debe ser de tipo `address`.

#### _data

Si se requieren variables de almacenamiento adicionales en tu contrato de cuenta, codifica las variables con ABI, 
pásalas a esta función como el argumento `bytes`.

Por ejemplo:


```solidity

function initializeAccount(
    address _admin,
    bytes calldata _data
) public override initializer {
    Account.initialize(_admin, _data);
}
```

</Details>
