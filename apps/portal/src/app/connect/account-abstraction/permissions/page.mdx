import { Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/ui/tabs";
import { createMetadata } from "@doc";

export const metadata = createMetadata({
	image: {
		title: "Permisos de Cuenta y Claves de Sesión",
		icon: "thirdweb",
	},
	title: "Permisos de Cuenta y Claves de Sesión | thirdweb",
	description:
		"Todos los contratos de cuenta - Simple y Administrada - comparten el mismo modelo de permisos. En esta sección, describiremos este modelo en detalle.",
});

# Permisos de Cuenta y Claves de Sesión

Todos los contratos de cuenta - [Simple](https://thirdweb.com/thirdweb.eth/AccountFactory) y [Administrada](https://thirdweb.com/thirdweb.eth/ManagedAccountFactory) - comparten el mismo modelo de permisos. En esta sección, describiremos este modelo en detalle.

Una cuenta reconoce solo dos tipos de actores: _Claves de Sesión_ y _Administradores_.

## 1. Administradores

Los administradores tienen **acceso sin restricciones** a la cuenta; pueden llamar a cualquier función en el contrato, usar el contrato sin pasar por la infraestructura de ERC-4337 (bundlers, EntryPoint, etc.), retirar el saldo de tokens nativos de la cuenta, entre otras acciones.

### Asignación de Permisos de Administrador

Los administradores existentes en la cuenta pueden agregar nuevos administradores, eliminar administradores existentes o renunciar a su estado de administrador.

<Tabs defaultValue="react">

<TabsList>
	<TabsTrigger value="react">React</TabsTrigger>
	<TabsTrigger value="typescript">TypeScript</TabsTrigger>
</TabsList>

<TabsContent value="react">

```tsx
import { addAdmin } from "thirdweb/extensions/erc4337";
import { useSendTransaction, useActiveAccount } from "thirdweb/react";
import { getContract } from "thirdweb";

const { mutate: sendTransaction } = useSendTransaction();
const smartAccount = useActiveAccount();

const onClick = () => {
	if (!smartAccount) return;
	const transaction = addAdmin({
		contract: getContract({
			address: smartAccount.address,
			chain,
			client,
		}),
		account: smartAccount,
		adminAddress: "0x...", // the address of the new admin
	});
	sendTransaction(transaction);
};
```

</TabsContent>
<TabsContent value="typescript">

```typescript
import { addAdmin } from "thirdweb/extensions/erc4337";
import { smartWallet } from "thirdweb/wallets";
import { sendTransaction, getContract } from "thirdweb";

const wallet = new smartWallet(config);
const smartAccount = await wallet.connect({
	client,
	personalAccount,
});

const transaction = addAdmin({
	contract: getContract({
		address: smartAccount.address,
		chain,
		client,
	}),
	account: smartAccount,
	adminAddress: "0x...", // the address of the new admin
});
await sendTransaction({
	transaction,
	account: smartAccount,
});
```

</TabsContent>
</Tabs>

## 2. Claves de Sesión

Las claves de sesión son firmantes adicionales autorizados que deben pasar por la infraestructura de ERC-4337 (bundlers, EntryPoint, etc.) para usar una cuenta y ejecutar transacciones. Las claves de sesión pueden utilizar una cuenta bajo ciertas restricciones.

### Asignación de Permisos a las Claves de Sesión

Cada clave de sesión individual tiene sus propios permisos para usar la cuenta. Solo los administradores pueden establecer los permisos para las claves de sesión.

Las claves de sesión pueden asignarse con los siguientes permisos:

- [Obligatorio] Permitir la interacción con contratos específicos usando la cuenta ("*" para cualquier contrato).
- [Opcional] Definir un monto máximo de tokens nativos que se pueden transferir por transacción (por defecto es 0 ETH, por lo que las transacciones con valor serán rechazadas).
- [Opcional] Restringir el acceso a la cuenta a un período de tiempo específico (por defecto es 10 años a partir de ahora).

Estas restricciones se establecen en la estructura `SignerPermissionsRequest`.  
Para definir los permisos de un firmante, se debe llamar a la función `setPermissionsForSigner`.

<Tabs defaultValue="react">

<TabsList>
	<TabsTrigger value="react">React</TabsTrigger>
	<TabsTrigger value="typescript">TypeScript</TabsTrigger>
	<TabsTrigger value="unity">Unity</TabsTrigger>
</TabsList>

  <TabsContent value="react">

```tsx
import { addSessionKey } from "thirdweb/extensions/erc4337";
import { useSendTransaction, useActiveAccount } from "thirdweb/react";
import { getContract } from "thirdweb";

const { mutate: sendTransaction } = useSendTransaction();
const smartAccount = useActiveAccount();

const onClick = () => {
	if (!smartAccount) return;
	const transaction = addSessionKey({
		contract: getContract({
			address: smartAccount.address,
			chain,
			client,
		}),
		account: smartAccount,
		sessionKeyAddress: "0x...", // the address of the account allowed to use the session key
		permissions: {
			approvedTargets: "*", // the addresses of allowed contracts, or '*' for any contract
			nativeTokenLimitPerTransaction: 0.1, // the maximum amount of native token (in ETH) that the session key can spend per transaction
			permissionStartTimestamp: new Date(), // the date when the session key becomes active
			permissionEndTimestamp: new Date(Date.now() + 24 * 60 * 60 * 1000), // the date when the session key expires
		},
	});
	sendTransaction(transaction);
};
```

</TabsContent>

<TabsContent value="typescript">

```ts
import { addSessionKey } from "thirdweb/extensions/erc4337";
import { wallet } from "thirdweb/wallets";
import { sendTransaction, getContract } from "thirdweb";

const wallet = new smartWallet(config);
const smartAccount = await smartWallet.connect({
	client,
	personalAccount,
});

const transaction = addSessionKey({
	contract: getContract({
		address: smartAccount.address,
		chain,
		client,
	}),
	account: smartAccount,
	sessionKeyAddress: "0x...", // the address of the new session key
	permissions: {
		approvedTargets: "*", // the addresses of allowed contracts, or '*' for any contract
		nativeTokenLimitPerTransaction: 0.1, // the maximum amount of native token (in ETH) that the session key can spend per transaction
		permissionStartTimestamp: new Date(), // the date when the session key becomes active
		permissionEndTimestamp: new Date(Date.now() + 24 * 60 * 60 * 1000), // the date when the session key expires
	},
});
await sendTransaction({
	transaction,
	account: smartAccount,
});
```

</TabsContent>
<TabsContent value="unity">

```csharp
using Thirdweb;

// Reference to your Thirdweb SDK
var sdk = ThirdwebManager.Instance.SDK;

// Create a session key
string signerAddress = "0xSignerAddress";
List<string> approvedTargets = new List<string> { "0xTargetAddress" };
string nativeTokenLimitPerTransactionInWei = "0";
string permissionStartTimestamp = "0";
string permissionEndTimestamp = Utils.GetUnixTimestampIn10Years().ToString();
string reqValidityStartTimestamp = "0";
string reqValidityEndTimestamp = Utils.GetUnixTimestampIn10Years().ToString();

await sdk.wallet.CreateSessionKey(
  "0xSignerAddress",
  approvedTargets,
  nativeTokenLimitPerTransactionInWei,
  permissionStartTimestamp,
  permissionEndTimestamp,
  reqValidityStartTimestamp,
  reqValidityEndTimestamp
);

```

</TabsContent>
</Tabs>
