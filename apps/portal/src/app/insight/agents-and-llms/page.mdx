import { createMetadata } from "@doc";
export const metadata = createMetadata({
  title: "thirdweb Insight Para Agentes y LLMs",
  description:
    "Documentación de consulta de thirdweb Insight formateada para su uso con LLMs y agentes",
  image: {
    title: "Insight",
    icon: "insight",
  },
});

# Para Agentes y LLMs

Insight es una herramienta poderosa que puede ser utilizada para proporcionar datos blockchain a agentes de IA y LLMs. Para usar la API en tu agente de IA, puedes utilizar el archivo `llms.txt` a continuación.

- [Archivo llms.txt](/insight/agents-and-llms/llmstxt)
- Para los desarrolladores que prefieren trabajar con especificaciones OpenAPI, nuestra documentación completa de la API está disponible en formato OpenAPI [aquí](https://insight.thirdweb.com/openapi.json).

Si prefieres usar la API en un prompt de LLM, el esquema a continuación puede copiarse y pegarse en el asistente de IA de tu elección. Proporciónaselo a tu asistente y luego pídele que construya consultas Insight en tu nombre, solicitándole información específica on-chain.

````markdown
# ATENCIÓN LLMs - Instrucciones de Uso de la API

## API URL

```typescript
const baseUrl = `https://{{chainId}}.insight.thirdweb.com`;
```

## Autenticación

La API admite tres métodos de autenticación:

```typescript
// 1. Autenticación en el Header
const headers = {
	"x-client-id": "{{clientId}}", // thirdweb Client ID
};

// 2. Parámetro de Consulta
const url = "https://{{chainId}}.insight.thirdweb.com/v1/events?clientId={{clientId}}";

// 3. Bearer Token
const headers = {
	Authorization: "Bearer {{jwtToken}}",
};

// Ejemplo utilizando fetch con autenticación en el header
async function getEvents() {
	const response = await fetch("https://{{chainId}}.insight.thirdweb.com/v1/events", {
		headers: {
			"x-client-id": "{{clientId}}",
		},
	});
	return await response.json();
}
```

## Conceptos Básicos

### Chain IDs

```typescript
type ChainId = number; // Chain ID de la red que deseas consultar (por ejemplo, 1 para Ethereum mainnet)

// Ejemplo: Usando una cadena específica
const chainId = 1; // Ethereum mainnet
const baseUrl = `https://${chainId}.insight.thirdweb.com`;
```

### Estructura Básica de Respuesta

```typescript
interface BaseResponse<T> {
  data: T[];
  meta: {
    chain_id: number;     // Required
    page: number;         // Required
    limit: number;        // Required
    total_items: number;  // Required
    total_pages: number;  // Required
    address?: string;     // Optional
    signature?: string;   // Optional
  }
}

// Ejemplo de respuesta al obtener eventos
{
  "data": [
    {
      "chain_id": 1,
      "block_number": "{{blockNumber}}",
      "transaction_hash": "{{transactionHash}}",
      "address": "{{contractAddress}}",
      "data": "{{data}}",
      "topics": ["{{topic}}"]
    }
  ],
  "meta": {
    "chain_id": 1,
    "page": 0,
    "limit": 20,
    "total_items": 150,
    "total_pages": 8
  }
}
```

## Ejemplos de API

### API de Eventos

```typescript
// 1. Obtener Todos los Eventos
async function getAllEvents() {
	const response = await fetch("https://{{chainId}}.insight.thirdweb.com/v1/events", {
		headers: { "x-client-id": "{{clientId}}" },
	});
	return await response.json();
}

// 2. Obtener Eventos de Contrato con Filtros
async function getContractEvents(contractAddress: string) {
	const params = new URLSearchParams({
		filter_block_number_gte: blockNumber,
		sort_by: "block_timestamp",
		sort_order: "desc",
		limit: "{{limit}}",
	});

	const url = `https://{{chainId}}.insight.thirdweb.com/v1/events/{{contractAddress}}?${params}`;
	const response = await fetch(url, {
		headers: { "x-client-id": "{{clientId}}" },
	});
	return await response.json();
}
```

### API de Saldo de Tokens

```typescript
// 1. Get ERC20 Balances
async function getERC20Balances(ownerAddress: string) {
	const response = await fetch(
		`https://{{chainId}}.insight.thirdweb.com/v1/tokens/erc20/${ownerAddress}`,
		{ headers: { "x-client-id": "{{clientId}}" } },
	);
	const data = await response.json();
	// Example response:
	// {
	//   "data": [
	//     {
	//       "tokenAddress": "0x123...",
	//       "balance": "1000000000000000000"
	//     }
	//   ]
	// }
	return data;
}

// 2. Obtener Saldos de NFTs
async function getNFTBalances(ownerAddress: string) {
	const response = await fetch(
		`https://{{chainId}}.insight.thirdweb.com/v1/tokens/erc721/${ownerAddress}`,
		{ headers: { "x-client-id": "{{clientId}}" } },
	);
	const data = await response.json();
	// Example response:
	// {
	//   "data": [
	//     {
	//       "collectionAddress": "0x456...",
	//       "tokenId": "1",
	//       "balance": "1"
	//     }
	//   ]
	// }
	return data;
}
```

### Usando Filtros

```typescript
// Ejemplo: Obtener eventos con filtros complejos
async function getFilteredEvents() {
	const params = new URLSearchParams({
		// Block filters
		filter_block_number_gte: blockNumberStart,
		filter_block_number_lte: blockNumberEnd,

		// Time filters
		filter_block_timestamp_gte: "{{timestamp}}",

		// Transaction filters
		filter_from_address: "{{fromAddress}}",
		filter_value_gte: "{{value}}", // 1 ETH

		// Pagination
		page: "{{page}}",
		limit: "{{limit}}",

		// Sorting
		sort_by: "{{sortBy}}",
		sort_order: "{{sortOrder}}",
	});

	const response = await fetch(
		`https://{{chainId}}.insight.thirdweb.com/v1/events?${params}`,
		{ headers: { "x-client-id": "{{clientId}}" } },
	);
	return await response.json();
}
```

### Manejo de Errores

```typescript
async function safeApiCall() {
	try {
		const response = await fetch("https://{{chainId}}.insight.thirdweb.com/v1/events", {
			headers: { "x-client-id": "{{clientId}}" },
		});

		if (!response.ok) {
			const errorData = await response.json();
			// Example error response:
			// { "error": "Invalid client ID" }
			throw new Error(errorData.error);
		}

		return await response.json();
	} catch (error) {
		console.error("API Error:", error.message);
		throw error;
	}
}
```

## Referencia de API

### API de Eventos

1. **Obtener Todos los Eventos**

```typescript
GET /v1/events

interface EventsResponse {
  data: Event[];
  meta: MetaData;
}
```

2. **Obtener Eventos de Contrato**

```typescript
GET /v1/events/:contractAddress
```

3. **Obtener Tipo de Evento Específico**

```typescript
GET /v1/events/:contractAddress/:signature
```

### API de Transacciones

1. **Obtener Todas las Transacciones**

```typescript
GET /v1/transactions
```

2. **Obtener Transacciones de Contrato**

```typescript
GET /v1/transactions/:contractAddress
```

3. **Obtener Tipo de Transacción Específico**

```typescript
GET /v1/transactions/:contractAddress/:signature
```

### API de Saldo de Tokens

1. **Balances de ERC20**

```typescript
GET /v1/tokens/erc20/:ownerAddress

interface ERC20Response {
  data: {
    tokenAddress: string;  // Required
    balance: string;      // Required
  }[];
}
```

2. **Balances de ERC721 y ERC1155**

```typescript
GET /v1/tokens/erc721/:ownerAddress
GET /v1/tokens/erc1155/:ownerAddress

interface TokenBalanceResponse {
  data: {
    collectionAddress: string;  // Required
    tokenId: string;           // Required
    balance: string;           // Required
  }[];
}
```

## Parámetros de Consulta

### Parámetros Comunes

```typescript
interface CommonQueryParams {
	page?: number;      // Default: 0
	limit?: number;     // Default: 20, must be > 0
	sort_by?: "block_number" | "block_timestamp" | "transaction_index";
	sort_order?: "asc" | "desc";
	group_by?: string;  // Group results by a specific field
	aggregate?: string[]; // Apply aggregate functions (count, sum, avg, etc.) to grouped results
}
```

### Tipos de Filtros

1. **Filtros de Bloques**

```typescript
interface BlockFilters {
	filter_block_number?: number; // Example: 1000000
	filter_block_number_gte?: number; // Example: 1000000
	filter_block_number_gt?: number; // Example: 1000000
	filter_block_number_lte?: number; // Example: 1000000
	filter_block_number_lt?: number; // Example: 1000000
	filter_block_hash?: string; // Example: "0x3a1fba5..."
}
```

2. **Filtros de Tiempo**

```typescript
interface TimeFilters {
	filter_block_timestamp?: number; // Example: 1715222400
	filter_block_timestamp_gte?: number; // Example: 1715222400
	filter_block_timestamp_gt?: number; // Example: 1715222400
	filter_block_timestamp_lte?: number; // Example: 1715222400
	filter_block_timestamp_lt?: number; // Example: 1715222400
}
```

3. **Filtros de Transacción**

```typescript
interface TransactionFilters {
	filter_transaction_index?: number;
	filter_transaction_hash?: string;
	filter_from_address?: string;
	filter_value?: string;    // Value in wei (e.g., "1000000000000000000" for 1 ETH)
	filter_value_gte?: string;
	filter_value_gt?: string;
	filter_value_lte?: string;
	filter_value_lt?: string;
	filter_gas_price?: number;
	filter_gas?: number;
	// Additional gte, gt, lte, lt variants for numeric fields
}
```

## Manejo de Errores

Todos los endpoints devuelven respuestas de error estándar para los códigos de estado 400 y 500:

```typescript
// 400 Bad Request
// 500 Internal Server Error
interface ErrorResponse {
	error: string; // Required
}
```
````