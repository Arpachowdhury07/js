import { createMetadata } from "@doc";

export const metadata = createMetadata({
	title: "Preventing Duplicate Transactions | thirdweb Engine",
	description: "Manage dashboard and API access to your Engine instance.",
});

# Prevención de transacciones duplicadas

Tu servidor backend puede implementar reintentos para manejar situaciones en las que no se recibe una respuesta HTTP exitosa de Engine. En estos casos, establece una **clave de idempotencia** para evitar la sumisión duplicada de la misma transacción.

Este enfoque previene errores costosos e irreversibles, como transferir fondos o acuñar NFTs más de una vez.

## Uso

Establece el encabezado `x-idempotency-key` con una cadena única.

Engine solo enviará una transacción si no se ha enviado otra transacción con la misma clave de idempotencia en las últimas 24 horas. Las llamadas subsiguientes con la misma clave de idempotencia devolverán el `queueId` de la transacción original.

## Ejemplo

Este ejemplo reintenta de forma segura una solicitud hasta tres veces si no se recibe una respuesta 2xx.


```typescript
const idempotencyKey = "27R82mBV"; // Some unique identifier from your app
const numRetries = 3;
let queueId: string | undefined;

for (let i = 0; i < numRetries; i++) {
	const resp = await fetch(url, {
		method: "POST",
		headers: {
			Authorization: `Bearer ${process.env.THIRDWEB_ACCESS_TOKEN}`,
			"Content-Type": "application/json",
			"x-backend-wallet-address": "0x4Ff9aa707AE1eAeb40E581DF2cf4e14AffcC553d",
			"x-idempotency-key": idempotencyKey,
		},
		body: JSON.stringify({
			to: "0x4Ff9aa707AE1eAeb40E581DF2cf4e14AffcC553d",
			amount: "42000000000",
		}),
	});

	// If 2xx, break. Else try again.
	if (resp.ok) {
		queueId = (await resp.json()).result;
		break;
	}
}

if (queueId) {
	console.log("Transaction submitted:", queueId);
} else {
	console.error("Unable to submit transaction.");
}
```
