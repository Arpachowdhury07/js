import { Callout } from "@doc";
import { createMetadata, DocImage } from "@doc";
import lifecycleImage from "../assets/tx-lifecycle.webp";

export const metadata = createMetadata({
	title: "Getting started with Engine | thirdweb Infrastructure",
	description:
		"Learn how to use Engine to manage your backend wallets and call contract methods",
});

# Comienza

Una vez que tengas Engine configurado, aprende lo básico sobre su funcionamiento.

## Aprende cómo funcionan las transacciones

Las llamadas **read** en blockchain (por ejemplo, obtener el saldo de un token) son sincrónicas y devolverán el valor leído.

Las llamadas **write** en blockchain (por ejemplo, transferir tokens) son asincrónicas:

- El backend de tu aplicación envía una transacción de escritura a Engine.
- Engine pone en cola el trabajo y devuelve una referencia al trabajo: `queueId`.
  - Si se devuelve `queueId`, esta transacción será procesada.
  - Si no se devuelve `queueId`, esta transacción no se agregó a la cola y no será procesada.
- Engine intentará enviar la transacción desde la billetera backend especificada.
  - Si ocurre un error (simulación fallida, falta de gas), la transacción se marca como `errored` y no será reintentada.
- Engine verifica si la transacción ha sido minada. Si lo está, se marca como `mined`.
- Si la transacción no se mina después de cierto tiempo, Engine reenvía la transacción con configuraciones de gas más agresivas. Esta transacción se envía con el mismo nonce y solo será minada una vez.

<DocImage
	src={lifecycleImage}
	alt="Ciclo de vida de una transacción"
	className="max-w-[800px] mx-auto"
/>

## Aprende qué significa cada estado de transacción

- **Queued**: La transacción fue recibida por Engine y está esperando en la cola de transacciones.
- **Sent**: La transacción fue enviada exitosamente al RPC.
- **Mined**: La transacción fue minada exitosamente en la cadena.
- **Cancelled**: La transacción fue cancelada por el usuario.
- **Errored**: La transacción falló al ser enviada al RPC o a los nodos de la cadena. Esto puede ocurrir por varias razones (transacción malformada, simulación fallida, gas insuficiente).

## Administra Engine desde el dashboard

<Callout variant='info' title="Verifica si Engine está configurado">

Tip: Navega a la URL de tu Engine. Deberías ver la siguiente respuesta: `Engine is set up successfully.`

</Callout>

Navega al [dashboard de thirdweb Engine](https://thirdweb.com/team/~/~/engine) para administrar tus instancias de Engine.

**Resumen**

- Ver tus billeteras backend.
- Crear una billetera backend.
- Ver transacciones recientes.
- Ver detalles de las transacciones (por ejemplo, mensajes de error, gas usado).
- Cancelar una transacción en cola.

**Explorer**

- Visualiza y llama interactivamente a tu API de Engine.

**Relayer**

- Ver relayers.
- Agregar o eliminar relayers.

**Configuración**

- Cambiar tipos de billetera backend.
- Ver webhooks.
- Agregar y eliminar webhooks.

**Permisos**

- Ver usuarios administradores.
- Agregar y eliminar usuarios administradores.
- Ver tokens de acceso.
- Crear y revocar tokens de acceso.

## Administra permisos

Los endpoints de Engine requieren autenticación.

- Agrega otros **administradores** para que otros usuarios administren Engine desde el dashboard.
- Crea **tokens de acceso** para que tus backends llamen a la API de Engine. _Estos son secretos que deben almacenarse de forma segura._
- Revoca permisos en cualquier momento.

Aprende más sobre [administradores](/engine/features/admins) y [tokens de acceso](/engine/features/access-tokens).

## Crea billeteras backend

Las **billeteras backend** son las billeteras gestionadas por Engine. Engine enviará transacciones blockchain desde estas billeteras.

- Configura cómo respaldar las billeteras.
- Crea o importa una billetera backend.
- Especifica la billetera backend a usar al llamar a la API de Engine.

[Aprende más sobre billeteras backend.](/engine/features/backend-wallets)

## Interactúa con la blockchain

Aquí tienes algunos ejemplos de llamadas a la API.

<Callout variant='info'>

Tip: Use the [TypeScript SDK](/engine/references/typescript) for type-safety.

</Callout>

### Obtener el saldo de una billetera

```ts
const resp = await fetch(
	"<engine_url>/backend-wallet/<chain>/<backend_wallet_address>/get-balance",
	{
		headers: {
			Authorization: "Bearer <access_token>",
		},
	},
);

const { result } = await resp.json();
console.log("Balance:", result.value);
```

### Leer desde un contrato

Este ejemplo de código no requiere fondos de gas y devuelve el resultado de la función.

```ts
const resp = await fetch(
	"<engine_url>/contract/<chain>/<contract_address>/read?functionName=balanceOf&args=0x3EcDBF3B911d0e9052b64850693888b008e18373",
	{
		headers: {
			Authorization: "Bearer <access_token>",
		},
	},
);

const { result } = await resp.json();
console.log("ERC-20 balance:", result);
```

### Escribir en un contrato

Este ejemplo de código llama a un método de escritura en un contrato. Requiere fondos de gas y devuelve un `queueId` para consultar el resultado.

```ts
const resp = await fetch(
	"<engine_url>/contract/<chain>/<contract_address>/write",
	{
		method: "POST",
		headers: {
			"Content-Type": "application/json",
			Authorization: "Bearer <access_token>",
			"x-backend-wallet-address": "<backend_wallet_address>",
		},
		body: JSON.stringify({
			functionName: "transferFrom",
			args: [
				"0x1946267d81Fb8aDeeEa28e6B98bcD446c8248473",
				"0x3EcDBF3B911d0e9052b64850693888b008e18373",
				"0",
			],
		}),
	},
);

const { result } = await resp.json();
// queueId is a reference to the transaction queued by Engine.
console.log("Queue ID:", result.queueId);
```

### Desplegar un contrato

Este ejemplo de código despliega un [contrato de NFT Drop de thirdweb](https://thirdweb.com/thirdweb.eth/DropERC721). Requiere fondos de gas y devuelve un `queueId` para consultar el resultado.

```ts
const resp = await fetch("<engine_url>/deploy/<chain>/prebuilts/nft-drop", {
	method: "POST",
	headers: {
		"Content-Type": "application/json",
		Authorization: "Bearer <access_token>",
		"x-backend-wallet-address": "<backend_wallet_address>",
	},
	body: JSON.stringify({
		contractMetadata: {
			name: "thirdweb Engine example",
			symbol: "eng",
			primary_sale_recipient: "0x3EcDBF3B911d0e9052b64850693888b008e18373",
		},
	}),
});

const { result } = await resp.json();
// queueId is a reference to the transaction queued by Engine.
console.log("Queue ID:", result.queueId);
```

Engine puede habilitar tu aplicación para realizar airdrops de NFTs, enviar fondos entre billeteras, actualizar el estado de juegos onchain y más.

### Verificar el estado de una transacción

```ts
const resp = await fetch("<engine_url>/transaction/status/<queue_id>", {
	method: "GET",
	headers: {
		Authorization: "Bearer <access_token>",
	},
});

const { result } = await resp.json();
// status can be: processed, queued, sent, errored, mined, cancelled, retried
const isComplete = ["mined", "errored", "cancelled"].includes(result.status);
```

## Configurar webhooks

Recibe notificaciones cuando una transacción sea minada, además de otros eventos de billetera y transacción.

- Navega a la pestaña **Webhooks** en el dashboard de Engine.
- Crea una nueva URL de webhook.

[Aprende más sobre webhooks.](/engine/features/webhooks)
