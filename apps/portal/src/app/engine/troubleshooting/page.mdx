import OutOfGasImage from "../assets/engine-out-of-gas.png";
import { Callout, createMetadata, DocImage } from "@doc";

export const metadata = createMetadata({
	title: "Solución de problemas | thirdweb Engine",
	description: "Recursos útiles para depurar problemas que puedas encontrar al usar thirdweb Engine.",
});

# Solución de problemas

Aquí tienes recursos útiles para depurar los problemas que puedas encontrar al usar thirdweb Engine.

## Enviar transacciones

### Recibido el error "UNPREDICTABLE_GAS_LIMIT"

**Lo que significa**

El RPC informó que esta transacción falló en la simulación y se espera que falle en la cadena, por lo que está siendo rechazada antes de ser enviada. No se consume gas. Este error indica que la lógica del contrato lanzará un error (o "revertirá la ejecución").

Razones comunes: minting desde un contrato de tokens que no tiene condiciones de reclamo, no ha comenzado el período de minting, se agotó el suministro, se pagó la cantidad incorrecta, la billetera backend que realiza la llamada no tiene permisos para llamar al contrato.

**Cómo resolverlo**

Intenta simular la transacción pasando el parámetro `?simulateTx=true` en la URL o usa el [Simulador de transacciones de thirdweb](https://thirdweb.com/tools/transaction-simulator) para revelar el mensaje de error.

### La transacción falló en la cadena

*También conocido como: ejecución revertida*

**Lo que significa**

La transacción pasó la simulación, pero la ejecución fue revertida en la cadena. Esto puede ocurrir si hubo un cambio en el estado, como que un contrato NFT se quedó sin suministro antes de que la transacción fuera minada.

Otra razón común es que la transacción se quedó sin gas. Puedes verificar esto revisando la sección "Más detalles" en tu explorador de bloques y confirmando si el uso de gas alcanzó el límite de gas:

<DocImage
	src={OutOfGasImage}
	alt="Sin gas"
	className="max-w-[500px] mx-auto"
/>

**Cómo resolverlo**

Si la transacción falló debido a la lógica en la cadena, intenta simular la transacción (ver arriba) para identificar la razón.

Si se alcanzó el límite de gas, puedes intentar [sobrescribir manualmente la configuración de gas](https://portal.thirdweb.com/engine/features/contracts#override-gas-settings). Engine estima automáticamente el límite de gas a través de simulación, y no se recomienda sobrescribir el límite de gas a menos que la estimación sea incorrecta.

### Recibido el error "replacement transaction underpriced"

*También conocido como: REPLACEMENT_UNDERPRICED, ya conocido*

**Lo que significa**

Engine ya ha enviado esta u otra transacción con el mismo nonce. Esa transacción está en el mempool y esperando ser minada por la cadena.

Engine maneja automáticamente los nonces, por lo que este error no debería ocurrir generalmente.

**Cómo resolverlo**

Es posible que las transacciones no estén siendo aceptadas por el mempool. Para resolver este problema, puedes volver a intentar la transacción, cancelarla o restablecer todos los nonces de la billetera backend.

Para reintentar una transacción, usa [`POST /transaction/sync-retry`](https://thirdweb-engine.apidocumentation.com/reference#tag/transaction/POST/transaction/sync-retry) y proporciona el `queueId`. También puedes proporcionar un valor de gas más alto para aumentar la probabilidad de que la transacción sea minada.

Para cancelar una transacción, usa [`POST /transaction/cancel`](https://thirdweb-engine.apidocumentation.com/reference#tag/transaction/POST/transaction/cancel) y proporciona el `queueId`.


<Callout
    title="Restablecer el nonce puede fallar transacciones anteriores"
	variant="warning"
>
    Las transacciones que fueron enviadas pero aún no minadas pueden fallar porque las nuevas transacciones utilizarán los mismos valores de nonce que las transacciones enviadas previamente.
</Callout>

Para restablecer el nonce de todas las billeteras backend, usa [`POST /backend-wallet/reset-nonce`](https://thirdweb-engine.apidocumentation.com/reference#tag/backend-wallet/POST/backend-wallet/reset-nonces) para forzar la sincronización de los nonces de Engine con los valores de la cadena.

### Recibido el error "Insufficient funds for gas * price + value"

*También conocido como: Fondos insuficientes para el costo intrínseco de la transacción*

**Lo que significa**

Tu billetera backend tiene fondos insuficientes para completar la transacción.

Ten en cuenta que en las cadenas EVM, una transacción debe colocar una *oferta de comisión de gas* en una transacción que sea mayor que la cantidad que realmente se consumirá. Esto significa que tu billetera debe tener una cantidad mínima de gas para enviar transacciones.

Puedes estimar cuántos fondos de gas se necesitan. Ajusta los valores a tu caso de uso y cadena.
- `gas` ("límite de gas"): La unidad de gas que una transacción necesita para completarse. Supón que un mint de NFT toma **120,000 gas**.
- `maxFeePerGas`: La cantidad máxima de token nativo para ofrecer, por gas. Supón **50 gwei**.
- La cantidad de gas necesaria = **6,000,000,000,000,000 wei**. Supón que la moneda nativa es ETH, que tiene 18 decimales, lo que equivale a 0.006 ETH.

Aunque se espera que la transacción consuma menos gas, la transacción fallará a menos que la billetera tenga al menos esta cantidad de moneda nativa de gas.

**Cómo resolverlo**

Agrega más fondos a tu billetera backend. O espera hasta que las comisiones de gas en la cadena sean más bajas y vuelve a intentarlo.

## Enviar UserOps

UserOps son **User Op**erations enviadas por una billetera backend en nombre de cuentas inteligentes, utilizadas en el patrón de Account Abstraction.

### Recibido el error "Invalid UserOperation signature or paymaster signature"

*También conocido como: código -32507*

**Lo que significa**

La billetera backend con la que estás enviando la transacción no tiene permisos suficientes para enviar un userOp para esta dirección de cuenta.

**Cómo resolverlo**

Confirma si la billetera backend es un administrador válido para esta cuenta.
Si estás usando Claves de Sesión, confirma que no estén cerca de su vencimiento o ya hayan expirado.

### Recibido el error "AA21 didn’t pay prefund"

**Lo que significa**

Tu clave API de thirdweb utilizada por Engine no está configurada correctamente para usar Account Abstraction, o has excedido una [regla de patrocinio](https://portal.thirdweb.com/connect/account-abstraction/sponsorship-rules).

**Cómo resolverlo**

Confirma si la clave API está vinculada a una cuenta con pago válido. También confirma si existen reglas de patrocinio para la clave API de Engine.
