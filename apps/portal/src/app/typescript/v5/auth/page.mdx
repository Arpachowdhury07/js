import { OpenSourceCard, Callout } from "@doc";

# Autenticación

Usando el estándar [`EIP-4361`](https://eips.ethereum.org/EIPS/eip-4361) (Iniciar sesión con Ethereum), puedes autenticar a los usuarios en tu backend utilizando solo su billetera. Esta es una forma segura y fácil de autenticar usuarios sin requerirles que creen una cuenta adicional.

## Uso

### Funciones del Cliente

<Callout variant="info" title="Autenticación con React">
	Si estás usando React, la autenticación se integra directamente con nuestro componente
	[ConnectButton](/react/v5/ConnectButton). Esto
	gestiona aspectos como el almacenamiento en caché, manejo de errores y reintentos por ti.
</Callout>


```ts
import { signLoginPayload } from 'thirdweb/auth';

// 1. obtener el login payload desde tu servidor
const result = await fetch(...);
const loginPayload = await result.json();

// 2. firmar el login payload con la cuenta del usuario
const signature = await signLoginPayload({ payload: loginPayload, account });

// 3. enviar el login payload y la firma a tu servidor
const result = await fetch(...);
const verifiedPayload = await result.json();
```

Cómo almacenas y mantienes la sesión de un usuario depende de ti, pero nuestra enfoque recomendado es almacenar un token JWT en una cookie que se verifique en el servidor. Las funciones del servidor a continuación incluyen funciones de utilidad para generar y verificar el JWT.

Para generar y verificar el JWT, también necesitarás una clave privada EOA. La billetera de esta clave privada no necesita tener fondos, solo se usa para firmar.

### Funciones del Servidor


```ts
import { createThirdwebClient } from "thirdweb";
import { createAuth } from "thirdweb/auth";
import { privateKeyToAccount } from "thirdweb/wallets";

const privateKey = process.env.THIRDWEB_PRIVATE_KEY;
const thirdwebClient = createThirdwebClient({
	secretKey: process.env.THIRDWEB_SECRET_KEY;
});

const auth = createAuth({
	domain: "localhost:3000",
	client: thirdwebClient,
	adminAccount: privateKeyToAccount({client, privateKey})
});

// 1. generar un login payload para un cliente en el lado del servidor
const loginPayload = await auth.generatePayload({ address: "0x123..." });

// 2. enviar el login payload al cliente para que lo firme

// 3. verificar el login payload y la firma que el cliente enviará más tarde
const verifiedPayload = await auth.verifyPayload({
	payload: loginPayload,
	signature: "0x123...",
});

// 4. generar un JWT para el cliente
const jwt = await auth.generateJWT({ payload: verifiedPayload });

// 5. establecer el JWT como una cookie o proporcionarlo al cliente de alguna otra manera

// 6. autenticar al cliente basándose en el JWT en las siguientes llamadas
const { valid, parsedJWT } = await auth.verifyJWT({ jwt });

```

## Repositorios de Ejemplo

<OpenSourceCard
	title="Auth + Next.js"
	href="https://github.com/thirdweb-example/thirdweb-auth-next"
	description="Un ejemplo funcional de Auth + Next.js"
/>

<OpenSourceCard
	title="Auth + Express"
	href="https://github.com/thirdweb-example/thirdweb-auth-express"
	description="Un ejemplo funcional de una app React + Express usando Auth"
/>

