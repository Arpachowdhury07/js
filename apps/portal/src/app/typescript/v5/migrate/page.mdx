import {
  ArticleIconCard,
} from "@doc";
import {
  ReactIcon,
} from "@/icons";

# Migración desde TypeScript SDK v4

<ArticleIconCard
	title="¿Buscas migrar al React SDK v5?"
	icon={ReactIcon}
	href="/react/v5/migrate"
	description="Consulta esta página para una guía detallada de migración a React"
/>

## ¿Por qué deberías migrar al SDK v5?

#### 1. Mejor rendimiento, clientes más felices
El nuevo SDK está diseñado con el rendimiento en mente y con un adecuado tree-shaking. Por lo tanto, el tamaño mínimo del paquete de tu aplicación se reduce significativamente.

A continuación, se muestra la comparación entre dos aplicaciones similares, utilizando `ConnectWallet` (v4) y `ConnectButton` (v5), que son idénticas en funcionalidad.

|                     | SDK v4 | SDK v5
| ------------------- | ------ | -------
| Tamaño mínimo del paquete | <span style={{color: 'red'}}>766kb</span>  | <span style={{color: 'green'}}>104kb</span>
| Dependencias        | `"@thirdweb-dev/react": "^4.9.4"`<br/>`"@thirdweb-dev/sdk": "^4.0.99"`<br/>`"ethers": "^5.7.2"`| `"thirdweb": "^5.42.0"`

_(Compilado con Next.js 14.2.5)_

#### 2. Más billeteras compatibles
El SDK v4 solo es compatible con un número limitado de billeteras web3 y, a medida que agregas más billeteras a tu aplicación, esta se vuelve más pesada.

El SDK v5 admite más de 300 billeteras y ¡este número sigue creciendo! Puedes [interactuar con las billeteras según sus IDs únicos](/typescript/v5/wallets#example-connect-a-wallet-and-access-an-account-to-send-a-transaction).
Por lo tanto, agregar más billeteras a tu aplicación tiene poco o ningún impacto en el tamaño final del paquete.

#### 3. Flexibilidad con React hooks
Al desarrollar una aplicación web3 en React con el SDK v4 de thirdweb, tienes acceso a un conjunto de hooks preconstruidos que te permiten interactuar fácilmente con tus contratos inteligentes.

El problema con este enfoque es que el número de métodos en los contratos inteligentes está en constante aumento, y para cada hook que no existe, tenemos que dedicar tiempo y esfuerzo
para escribirlo, probarlo y mantenerlo. Este proceso consume mucho tiempo y, sinceramente, cuantas más dependencias de hooks de React agregues a tu aplicación, más lenta y difícil de mantener se vuelve.

En el SDK v5, introducimos un nuevo concepto llamado "extensiones preconstruidas": un conjunto de métodos de lectura y escritura para contratos populares que puedes _conectar y usar_. Por ejemplo:

###### Leer estados del contrato con v5

```ts
// Get a list of owned ERC721 tokens in a wallet
import { useReadContract } from "thirdweb/react";
import { getOwnedNFTs } from "thirdweb/extensions/erc721";

const { data } = useReadContract(getOwned, { contract, owner });
```

###### Escribir en un contrato con v5

```ts
// Claim an NFT from thirdweb Drop contract
import { useSendTransaction } from "thirdweb/react";
import { claimTo } from "thirdweb/extensions/erc721";

const { mutate: sendTx } = useSendTransaction();
const transaction = claimTo({
  contract,
  to: "0x...",
  quantity: 1n,
});
sendTx(transaction);
```

Como puedes ver, al combinar las extensiones de contrato con `useReadContract` (para lectura) y `useSendTransaction` (para escritura),
podemos reducir significativamente la cantidad de código que se empaqueta y envía a los usuarios finales. Además, con este enfoque podemos dedicar más tiempo 
a desarrollar extensiones de contrato. Actualmente, el SDK v5 admite cientos de extensiones, incluyendo protocolos populares como Uniswap, Farcaster, Lens y más por venir.

Consulta la lista de [extensiones compatibles](/typescript/v5/extensions/built-in) aquí, o [crea tu propia extensión](/typescript/v5/extensions/create)!



#### 4. Acceso al software más reciente
Actualmente, el SDK v4 utiliza `ethers@5.7.2` y `@tanstack/react-query@^4`, los cuales pueden considerarse versiones "desactualizadas".  
Lamentablemente, no tenemos planes de actualizar las dependencias de la versión v4 a las últimas versiones.  
Te recomendamos encarecidamente migrar al SDK v5 para recibir las últimas actualizaciones de software con mejor seguridad y rendimiento.  
¿Quieres seguir usando ethers.js 5? ¡No te preocupes! El SDK v5 incluye potentes adaptadores que te permiten usar thirdweb con frameworks web3 populares como viem o ethers 5 y 6.  
[Más información](/typescript/v5/adapters#ethers-v5)  


<hr/>

## Cambios principales

- Todas las importaciones de `@thirdweb-dev/*` deben reemplazarse con el SDK `thirdweb` usando sub-exportaciones.
- El nuevo SDK está basado en `funciones` en lugar de `clases` para mejorar el tree shaking y el rendimiento.
- Todas las llamadas a contratos ahora se preparan con `prepareContractCall` y se envían con la función `sendTransaction`.
- Las transacciones se envían sin esperar el recibo por defecto. Puedes llamar a la función `waitForReceipt` para esperar a que la transacción sea minada.

## Migración progresiva

Si actualmente estás usando `@thirdweb-dev/sdk`, puedes migrar progresivamente al nuevo SDK `thirdweb`. Ambos SDKs pueden usarse en paralelo y son interoperables entre sí.

Puedes compartir fácilmente la misma billetera entre los dos SDKs usando la utilidad `ethers5adapter`, lo que te permite reemplazar llamadas una por una de manera progresiva.

```ts
import { ThirdwebSDK } from "@thirdweb-dev/sdk";
import { prepareContractCall, sendTransaction } from "thirdweb";
import { ethers5Adapter } from "thirdweb/adapters/ethers5";

const sdk = ThirdwebSDK.fromPrivateKey(pkey, chain);

// convert the signer to be used with the new thirdweb SDK
const account = await ethers5Adapter.signer.fromEthers(sdk.getSigner());

// then use the new thirdweb SDK normally
const transaction = prepareContractCall({ ... });
await sendTransaction({
	transaction,
	account,
});
```

En React, puedes combinar los `ThirdwebProvider` de v4 y v5, lo que te da acceso a los hooks y funcionalidades de ambos SDKs.

```tsx
import { ThirdwebProvider} from "@thirdweb-dev/react" }
import { ThirdwebProvider as ThirdwebProviderV5 } from "thirdweb/react"

<ThirdwebProvider activeChain={...} clientId={...}>
  <ThirdwebProviderV5>
     ...
  </ThirdwebProviderV5>
</V4TWProvider>
```

A partir de ahí, puedes obtener el firmante actual usando el hook `useSigner` y convertirlo cuando sea necesario utilizando `ethers5Adapter`:

```tsx
import { useSigner } from "@thirdweb-dev/react";
import { ethers5Adapter } from "thirdweb/adapters/ethers5";

const signer = useSigner();

const onClick = async () => {
    // convert the signer to used with the new SDK
	const account = await ethers5Adapter.signer.fromEthers(signer);
    // then use the new SDK normally
    const transaction = prepareContractCall({ ... });
    await sendTransaction({
	    transaction,
	    account,
    });
};
```

## Guía rápida de TypeScript

| Tarea       | `@thirdweb-dev/sdk`                                      | `thirdweb`                                        |
| ---------- | -------------------------------------------------------- | ------------------------------------------------- |
| Cadenas    | `import { Sepolia } from "@thirdweb-dev/chains"`         | [`import { sepolia } from "thirdweb/chains"`](/typescript/v5/chain)       |
| Billeteras | `import { MetaMaskWallet } from "@thirdweb-dev/wallets"` | [`import { createWallet } from "thirdweb/wallets"`](/references/typescript/v5/createWallet) |
| Inicializar | `new ThirdwebSDK(...)`                                   | [`createThirdwebClient({ ... })`](/references/typescript/v5/createThirdwebClient)                   |
| Contrato   | `await sdk.getContract(...)`                             | [`getContract(...) // sin await`](/references/typescript/v5/getContract)                    |
| Leer       | `await contract.call(...)`                               | [`await readContract(...)`](/references/typescript/v5/readContract)                         |
| Preparar   | `await contract.prepare(...)`                            | [`prepareContractCall(...) // sin await`](/references/typescript/v5/prepareContractCall)            |
| Enviar     | `await contract.call(...)`                               | [`await sendTransaction(...)`](/references/typescript/v5/sendTransaction)                      |
| Extensiones | `await contract.erc721.getAll()`                         | [`await getNFTs(...)`](/references/typescript/v5/erc721/getNFTs)                              |
| Desplegar  | `sdk.deployer.deployBuiltInContract(...)`                | [`await deployPublishedContract(...)`](/references/typescript/v5/deploy/deployPublishedContract)              |


## Guía rápida de React

| Tarea                 | `@thirdweb-dev/react`                                 | `thirdweb`                                          |
| ---------------------| ----------------------------------------------------- | --------------------------------------------------- |
| Proveedor            | `import { ThirdwebProvider} from @thirdweb-dev/react` | [`import { ThirdwebProvider } from "thirdweb/react"`](/react/v5/ThirdwebProvider) |
| Contrato             | `useContract(...)`                                    | [`getContract(...) // no es un hook`](/references/typescript/v5/getContract)                    |
| Dirección            | `useAddress(...)`                                     | [`useActiveAccount(...) // account?.address`](/references/typescript/v5/useActiveAccount)         |
| Leer                 | `useContractRead(...)`                                | [`useReadContract(...)`](/references/typescript/v5/useReadContract)                              |
| Escribir             | `useContractWrite(...)`                               | [`useSendTransaction()`](/references/typescript/v5/useSendTransaction)                             |
| Extensiones         | `useNFTs(...)`                                        | [`useReadContract(getNFTs, { ... })`](/references/typescript/v5/useReadContract)                |
| Obtener Signer       | `useSigner()`                                         | [`useActiveAccount()`](/references/typescript/v5/useActiveAccount)                                |
| Obtener Billetera   | `useWallet()`                                         | [`useActiveWallet()`](/references/typescript/v5/useActiveWallet)                                 |
| Botón                | `Web3Button`                                          | [`TransactionButton`](/react/v5/TransactionButton)                                 |
| Conectar            | `ConnectWallet`                                       | [`ConnectButton`](/react/v5/ConnectButton)                                     |
| Estado de conexión  | `useConnectionStatus()`                               | [`useActiveWalletConnectionStatus()`](/references/typescript/v5/useActiveWalletConnectionStatus)                 |
| Cambiar cadena      | `useSwitchChain()`                                    | [`useSwitchActiveWalletChain()`](/references/typescript/v5/useSwitchActiveWalletChain)                      |
| Obtener cadena conectada | `useChain()`                                          | [`useActiveWalletChain()`](/references/typescript/v5/useActiveWalletChain)                  |
